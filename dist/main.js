// UMD Module
(function (root, factory) {
  if (typeof module === 'object' && module.exports) {
    // Node. Does not work with strict CommonJS, but
    // only CommonJS-like environments that support module.exports,
    // like Node.
    module.exports = factory;
  } else if (typeof define === 'function' && define.amd) {
    // AMD. Register a named module.
    define('asciidoctor/docbook', ['asciidoctor'], function () {
      return factory();
    });
  } else {
    // Browser globals (root is window)
    if (typeof root.Asciidoctor === 'undefined') {
      throw new Error('Asciidoctor.js should be loaded before Asciidoctor DocBook.js');
    }
    root.Asciidoctor.DocBook = factory;
  }
}(this, function () {
/* Generated by Opal 0.11.1.dev */
(function(Opal) {
  function $rb_minus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs - rhs : lhs['$-'](rhs);
  }
  function $rb_gt(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs > rhs : lhs['$>'](rhs);
  }
  function $rb_plus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs + rhs : lhs['$+'](rhs);
  }
  var self = Opal.top, $nesting = [], nil = Opal.nil, $$$ = Opal.const_get_qualified, $$ = Opal.const_get_relative, $breaker = Opal.breaker, $slice = Opal.slice, $module = Opal.module, $klass = Opal.klass, $hash2 = Opal.hash2, $send = Opal.send, $truthy = Opal.truthy, $gvars = Opal.gvars;

  Opal.add_stubs(['$register_for', '$default=', '$-', '$init_backend_traits', '$attr?', '$<<', '$attr', '$==', '$doctype', '$common_attributes', '$id', '$noheader', '$document_info_tag', '$empty?', '$docinfo', '$blocks?', '$content', '$join', '$document', '$[]', '$sectname', '$special', '$option?', '$title', '$role', '$reftext', '$title_tag', '$enclose_content', '$title?', '$each', '$items', '$text', '$style', '$text?', '$level', '$image_uri', '$alt', '$!', '$key?', '$attributes', '$to_i', '$index', '$subs', '$delete_at', '$>', '$insert', '$unshift', '$asciimath_available?', '$to_mathml', '$parse', '$===', '$parent', '$warn', '$logger', '$context', '$error', '$content_model', '$blockquote_tag', '$has_role?', '$include?', '$columns', '$to_h', '$rows', '$colspan', '$column', '$+', '$rowspan', '$type', '$target', '$inspect', '$icon_uri', '$map', '$size', '$chop', '$private', '$gsub', '$strip', '$squeeze', '$firstname', '$sub_replacements', '$middlename', '$lastname', '$email', '$notitle', '$subtitle?', '$doctitle', '$main', '$subtitle', '$=~', '$header?', '$authors', '$author_tag', '$initials', '$cover_tag', '$new', '$load_asciimath', '$nil?', '$require_library']);
  return (function($base, $parent_nesting) {
    function $Asciidoctor() {};
    var self = $Asciidoctor = $module($base, 'Asciidoctor', $Asciidoctor);

    var def = self.prototype, $nesting = [self].concat($parent_nesting);

    (function($base, $super, $parent_nesting) {
      function $DocBook5Converter(){};
      var self = $DocBook5Converter = $klass($base, $super, 'DocBook5Converter', $DocBook5Converter);

      var def = self.prototype, $nesting = [self].concat($parent_nesting), TMP_DocBook5Converter_initialize_1, TMP_DocBook5Converter_convert_document_2, TMP_DocBook5Converter_convert_section_3, TMP_DocBook5Converter_convert_admonition_4, TMP_DocBook5Converter_convert_colist_6, TMP_DocBook5Converter_convert_dlist_11, TMP_DocBook5Converter_convert_example_12, TMP_DocBook5Converter_convert_floating_title_13, TMP_DocBook5Converter_convert_image_14, TMP_DocBook5Converter_convert_listing_15, TMP_DocBook5Converter_convert_literal_16, TMP_DocBook5Converter_convert_stem_17, TMP_DocBook5Converter_convert_olist_19, TMP_DocBook5Converter_convert_open_20, TMP_DocBook5Converter_convert_page_break_21, TMP_DocBook5Converter_convert_paragraph_22, TMP_DocBook5Converter_convert_preamble_23, TMP_DocBook5Converter_convert_quote_25, TMP_DocBook5Converter_convert_thematic_break_26, TMP_DocBook5Converter_convert_sidebar_27, TMP_DocBook5Converter_convert_table_33, TMP_DocBook5Converter_convert_ulist_36, TMP_DocBook5Converter_convert_verse_38, TMP_DocBook5Converter_convert_inline_anchor_39, TMP_DocBook5Converter_convert_inline_break_40, TMP_DocBook5Converter_convert_inline_button_41, TMP_DocBook5Converter_convert_inline_callout_42, TMP_DocBook5Converter_convert_inline_footnote_43, TMP_DocBook5Converter_convert_inline_image_44, TMP_DocBook5Converter_convert_inline_indexterm_46, TMP_DocBook5Converter_convert_inline_kbd_47, TMP_DocBook5Converter_convert_inline_menu_48, TMP_DocBook5Converter_convert_inline_quoted_49, TMP_DocBook5Converter_common_attributes_50, TMP_DocBook5Converter_author_tag_51, TMP_DocBook5Converter_document_info_tag_54, TMP_DocBook5Converter_enclose_content_55, TMP_DocBook5Converter_title_tag_56, TMP_DocBook5Converter_cover_tag_57, TMP_DocBook5Converter_blockquote_tag_58, TMP_DocBook5Converter_asciimath_available$q_59, TMP_DocBook5Converter_load_asciimath_60, $writer = nil;

      def.asciimath_status = nil;
      
      self.$register_for("docbook5");
      
      $writer = [$hash2(["list", "entry", "term", "item"], {"list": "variablelist", "entry": "varlistentry", "term": "term", "item": "listitem"})];
      $send(Opal.const_set($nesting[0], 'DLIST_TAGS', $hash2(["qanda", "glossary"], {"qanda": $hash2(["list", "entry", "label", "term", "item"], {"list": "qandaset", "entry": "qandaentry", "label": "question", "term": "simpara", "item": "answer"}), "glossary": $hash2(["list", "entry", "term", "item"], {"list": nil, "entry": "glossentry", "term": "glossterm", "item": "glossdef"})})), 'default=', Opal.to_a($writer));
      $writer[$rb_minus($writer["length"], 1)];;
      
      $writer = [["", "", true]];
      $send(Opal.const_set($nesting[0], 'QUOTE_TAGS', $hash2(["monospaced", "emphasis", "strong", "double", "single", "mark", "superscript", "subscript"], {"monospaced": ["<literal>", "</literal>"], "emphasis": ["<emphasis>", "</emphasis>", true], "strong": ["<emphasis role=\"strong\">", "</emphasis>", true], "double": ["<quote>", "</quote>", true], "single": ["<quote>", "</quote>", true], "mark": ["<emphasis role=\"marked\">", "</emphasis>"], "superscript": ["<superscript>", "</superscript>"], "subscript": ["<subscript>", "</subscript>"]})), 'default=', Opal.to_a($writer));
      $writer[$rb_minus($writer["length"], 1)];;
      Opal.const_set($nesting[0], 'MANPAGE_SECTION_TAGS', $hash2(["section", "synopsis"], {"section": "refsection", "synopsis": "refsynopsisdiv"}));
      Opal.const_set($nesting[0], 'TABLE_PI_NAMES', ["dbhtml", "dbfo", "dblatex"]);
      Opal.const_set($nesting[0], 'CopyrightRx', /^(.+?)(?: ((?:\d{4}\-)?\d{4}))?$/);
      Opal.const_set($nesting[0], 'ImageMacroRx', /^image::?(.+?)\[(.*?)\]$/);
      
      Opal.def(self, '$initialize', TMP_DocBook5Converter_initialize_1 = function $$initialize(backend, opts) {
        var self = this;

        if (opts == null) {
          opts = $hash2([], {});
        }
        
        self.backend = backend;
        return self.$init_backend_traits($hash2(["basebackend", "filetype", "outfilesuffix", "supports_templates"], {"basebackend": "docbook", "filetype": "xml", "outfilesuffix": ".xml", "supports_templates": true}));
      }, TMP_DocBook5Converter_initialize_1.$$arity = -2);
      
      Opal.def(self, '$convert_document', TMP_DocBook5Converter_convert_document_2 = function $$convert_document(node) {
        var self = this, result = nil, lang_attribute = nil, root_tag_name = nil, docinfo_content = nil;

        
        result = ["<?xml version=\"1.0\" encoding=\"UTF-8\"?>"];
        if ($truthy(node['$attr?']("toc"))) {
          if ($truthy(node['$attr?']("toclevels"))) {
            result['$<<']("" + "<?asciidoc-toc maxdepth=\"" + (node.$attr("toclevels")) + "\"?>")
          } else {
            result['$<<']("<?asciidoc-toc?>")
          }};
        if ($truthy(node['$attr?']("sectnums"))) {
          if ($truthy(node['$attr?']("sectnumlevels"))) {
            result['$<<']("" + "<?asciidoc-numbered maxdepth=\"" + (node.$attr("sectnumlevels")) + "\"?>")
          } else {
            result['$<<']("<?asciidoc-numbered?>")
          }};
        lang_attribute = (function() {if ($truthy(node['$attr?']("nolang"))) {
          return ""
        } else {
          return "" + " xml:lang=\"" + (node.$attr("lang", "en")) + "\""
        }; return nil; })();
        if ((root_tag_name = node.$doctype())['$==']("manpage")) {
          root_tag_name = "refentry"};
        result['$<<']("" + "<" + (root_tag_name) + " xmlns=\"http://docbook.org/ns/docbook\" xmlns:xl=\"http://www.w3.org/1999/xlink\" version=\"5.0\"" + (lang_attribute) + (self.$common_attributes(node.$id())) + ">");
        if ($truthy(node.$noheader())) {
        } else {
          result['$<<'](self.$document_info_tag(node))
        };
        if ($truthy((docinfo_content = node.$docinfo("header"))['$empty?']())) {
        } else {
          result['$<<'](docinfo_content)
        };
        if ($truthy(node['$blocks?']())) {
          result['$<<'](node.$content())};
        if ($truthy((docinfo_content = node.$docinfo("footer"))['$empty?']())) {
        } else {
          result['$<<'](docinfo_content)
        };
        result['$<<']("" + "</" + (root_tag_name) + ">");
        return result.$join($$($nesting, 'LF'));
      }, TMP_DocBook5Converter_convert_document_2.$$arity = 1);
      Opal.alias(self, "convert_embedded", "content_only");
      
      Opal.def(self, '$convert_section', TMP_DocBook5Converter_convert_section_3 = function $$convert_section(node) {
        var $a, self = this, tag_name = nil, title_el = nil;

        
        if (node.$document().$doctype()['$==']("manpage")) {
          tag_name = ($truthy($a = $$($nesting, 'MANPAGE_SECTION_TAGS')['$[]']((tag_name = node.$sectname()))) ? $a : tag_name)
        } else {
          tag_name = node.$sectname()
        };
        title_el = (function() {if ($truthy(($truthy($a = node.$special()) ? node['$option?']("untitled") : $a))) {
          return ""
        } else {
          return "" + "<title>" + (node.$title()) + "</title>\n"
        }; return nil; })();
        return "" + "<" + (tag_name) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (title_el) + (node.$content()) + "\n" + "</" + (tag_name) + ">";
      }, TMP_DocBook5Converter_convert_section_3.$$arity = 1);
      
      Opal.def(self, '$convert_admonition', TMP_DocBook5Converter_convert_admonition_4 = function $$convert_admonition(node) {
        var self = this, tag_name = nil;

        return "" + "<" + ((tag_name = node.$attr("name"))) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$title_tag(node)) + (self.$enclose_content(node)) + "\n" + "</" + (tag_name) + ">"
      }, TMP_DocBook5Converter_convert_admonition_4.$$arity = 1);
      Opal.alias(self, "convert_audio", "skip");
      
      Opal.def(self, '$convert_colist', TMP_DocBook5Converter_convert_colist_6 = function $$convert_colist(node) {
        var TMP_5, self = this, result = nil;

        
        result = [];
        result['$<<']("" + "<calloutlist" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">");
        if ($truthy(node['$title?']())) {
          result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
        $send(node.$items(), 'each', [], (TMP_5 = function(item){var self = TMP_5.$$s || this;
if (item == null) item = nil;
        
          result['$<<']("" + "<callout arearefs=\"" + (item.$attr("coids")) + "\">");
          result['$<<']("" + "<para>" + (item.$text()) + "</para>");
          if ($truthy(item['$blocks?']())) {
            result['$<<'](item.$content())};
          return result['$<<']("</callout>");}, TMP_5.$$s = self, TMP_5.$$arity = 1, TMP_5));
        result['$<<']("</calloutlist>");
        return result.$join($$($nesting, 'LF'));
      }, TMP_DocBook5Converter_convert_colist_6.$$arity = 1);
      
      Opal.def(self, '$convert_dlist', TMP_DocBook5Converter_convert_dlist_11 = function $$convert_dlist(node) {
        var TMP_7, TMP_9, self = this, result = nil, tag_name = nil, tags = nil, list_tag = nil, entry_tag = nil, label_tag = nil, term_tag = nil, item_tag = nil;

        
        result = [];
        if (node.$style()['$==']("horizontal")) {
          
          result['$<<']("" + "<" + ((tag_name = (function() {if ($truthy(node['$title?']())) {
            return "table"
          } else {
            return "informaltable"
          }; return nil; })())) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + " tabstyle=\"horizontal\" frame=\"none\" colsep=\"0\" rowsep=\"0\">\n" + (self.$title_tag(node)) + "<tgroup cols=\"2\">\n" + "<colspec colwidth=\"" + (node.$attr("labelwidth", 15)) + "*\"/>\n" + "<colspec colwidth=\"" + (node.$attr("itemwidth", 85)) + "*\"/>\n" + "<tbody valign=\"top\">");
          $send(node.$items(), 'each', [], (TMP_7 = function(terms, dd){var self = TMP_7.$$s || this, TMP_8;
if (terms == null) terms = nil;if (dd == null) dd = nil;
          
            result['$<<']("" + "<row>\n" + "<entry>");
            $send(terms, 'each', [], (TMP_8 = function(dt){var self = TMP_8.$$s || this;
if (dt == null) dt = nil;
            return result['$<<']("" + "<simpara>" + (dt.$text()) + "</simpara>")}, TMP_8.$$s = self, TMP_8.$$arity = 1, TMP_8));
            result['$<<']("" + "</entry>\n" + "<entry>");
            if ($truthy(dd)) {
              
              if ($truthy(dd['$text?']())) {
                result['$<<']("" + "<simpara>" + (dd.$text()) + "</simpara>")};
              if ($truthy(dd['$blocks?']())) {
                result['$<<'](dd.$content())};};
            return result['$<<']("" + "</entry>\n" + "</row>");}, TMP_7.$$s = self, TMP_7.$$arity = 2, TMP_7));
          result['$<<']("" + "</tbody>\n" + "</tgroup>\n" + "</" + (tag_name) + ">");
        } else {
          
          tags = $$($nesting, 'DLIST_TAGS')['$[]'](node.$style());
          list_tag = tags['$[]']("list");
          entry_tag = tags['$[]']("entry");
          label_tag = tags['$[]']("label");
          term_tag = tags['$[]']("term");
          item_tag = tags['$[]']("item");
          if ($truthy(list_tag)) {
            
            result['$<<']("" + "<" + (list_tag) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">");
            if ($truthy(node['$title?']())) {
              result['$<<']("" + "<title>" + (node.$title()) + "</title>")};};
          $send(node.$items(), 'each', [], (TMP_9 = function(terms, dd){var self = TMP_9.$$s || this, TMP_10;
if (terms == null) terms = nil;if (dd == null) dd = nil;
          
            result['$<<']("" + "<" + (entry_tag) + ">");
            if ($truthy(label_tag)) {
              result['$<<']("" + "<" + (label_tag) + ">")};
            $send(terms, 'each', [], (TMP_10 = function(dt){var self = TMP_10.$$s || this;
if (dt == null) dt = nil;
            return result['$<<']("" + "<" + (term_tag) + ">" + (dt.$text()) + "</" + (term_tag) + ">")}, TMP_10.$$s = self, TMP_10.$$arity = 1, TMP_10));
            if ($truthy(label_tag)) {
              result['$<<']("" + "</" + (label_tag) + ">")};
            result['$<<']("" + "<" + (item_tag) + ">");
            if ($truthy(dd)) {
              
              if ($truthy(dd['$text?']())) {
                result['$<<']("" + "<simpara>" + (dd.$text()) + "</simpara>")};
              if ($truthy(dd['$blocks?']())) {
                result['$<<'](dd.$content())};};
            result['$<<']("" + "</" + (item_tag) + ">");
            return result['$<<']("" + "</" + (entry_tag) + ">");}, TMP_9.$$s = self, TMP_9.$$arity = 2, TMP_9));
          if ($truthy(list_tag)) {
            result['$<<']("" + "</" + (list_tag) + ">")};
        };
        return result.$join($$($nesting, 'LF'));
      }, TMP_DocBook5Converter_convert_dlist_11.$$arity = 1);
      
      Opal.def(self, '$convert_example', TMP_DocBook5Converter_convert_example_12 = function $$convert_example(node) {
        var self = this;

        if ($truthy(node['$title?']())) {
          return "" + "<example" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + (self.$enclose_content(node)) + "\n" + "</example>"
        } else {
          return "" + "<informalexample" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$enclose_content(node)) + "\n" + "</informalexample>"
        }
      }, TMP_DocBook5Converter_convert_example_12.$$arity = 1);
      
      Opal.def(self, '$convert_floating_title', TMP_DocBook5Converter_convert_floating_title_13 = function $$convert_floating_title(node) {
        var self = this;

        return "" + "<bridgehead" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + " renderas=\"sect" + (node.$level()) + "\">" + (node.$title()) + "</bridgehead>"
      }, TMP_DocBook5Converter_convert_floating_title_13.$$arity = 1);
      
      Opal.def(self, '$convert_image', TMP_DocBook5Converter_convert_image_14 = function $$convert_image(node) {
        var self = this, width_attribute = nil, depth_attribute = nil, scale_attribute = nil, align_attribute = nil, mediaobject = nil;

        
        if ($truthy(node['$attr?']("scaledwidth"))) {
          
          width_attribute = "" + " width=\"" + (node.$attr("scaledwidth")) + "\"";
          depth_attribute = "";
          scale_attribute = "";
        } else if ($truthy(node['$attr?']("scale"))) {
          scale_attribute = "" + " scale=\"" + (node.$attr("scale")) + "\""
        } else {
          
          width_attribute = (function() {if ($truthy(node['$attr?']("width"))) {
            return "" + " contentwidth=\"" + (node.$attr("width")) + "\""
          } else {
            return ""
          }; return nil; })();
          depth_attribute = (function() {if ($truthy(node['$attr?']("height"))) {
            return "" + " contentdepth=\"" + (node.$attr("height")) + "\""
          } else {
            return ""
          }; return nil; })();
          scale_attribute = "";
        };
        align_attribute = (function() {if ($truthy(node['$attr?']("align"))) {
          return "" + " align=\"" + (node.$attr("align")) + "\""
        } else {
          return ""
        }; return nil; })();
        mediaobject = "" + "<mediaobject>\n" + "<imageobject>\n" + "<imagedata fileref=\"" + (node.$image_uri(node.$attr("target"))) + "\"" + (width_attribute) + (depth_attribute) + (scale_attribute) + (align_attribute) + "/>\n" + "</imageobject>\n" + "<textobject><phrase>" + (node.$alt()) + "</phrase></textobject>\n" + "</mediaobject>";
        if ($truthy(node['$title?']())) {
          return "" + "<figure" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + (mediaobject) + "\n" + "</figure>"
        } else {
          return "" + "<informalfigure" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (mediaobject) + "\n" + "</informalfigure>"
        };
      }, TMP_DocBook5Converter_convert_image_14.$$arity = 1);
      
      Opal.def(self, '$convert_listing', TMP_DocBook5Converter_convert_listing_15 = function $$convert_listing(node) {
        var self = this, informal = nil, common_attrs = nil, attrs = nil, numbering_attrs = nil, wrapped_content = nil;

        
        informal = node['$title?']()['$!']();
        common_attrs = self.$common_attributes(node.$id(), node.$role(), node.$reftext());
        if (node.$style()['$==']("source")) {
          
          if ($truthy((attrs = node.$attributes())['$key?']("linenums"))) {
            numbering_attrs = (function() {if ($truthy(attrs['$key?']("start"))) {
              return "" + " linenumbering=\"numbered\" startinglinenumber=\"" + (attrs['$[]']("start").$to_i()) + "\""
            } else {
              return " linenumbering=\"numbered\""
            }; return nil; })()
          } else {
            numbering_attrs = " linenumbering=\"unnumbered\""
          };
          if ($truthy(attrs['$key?']("language"))) {
            wrapped_content = "" + "<programlisting" + ((function() {if ($truthy(informal)) {
              return common_attrs
            } else {
              return ""
            }; return nil; })()) + " language=\"" + (attrs['$[]']("language")) + "\"" + (numbering_attrs) + ">" + (node.$content()) + "</programlisting>"
          } else {
            wrapped_content = "" + "<screen" + ((function() {if ($truthy(informal)) {
              return common_attrs
            } else {
              return ""
            }; return nil; })()) + (numbering_attrs) + ">" + (node.$content()) + "</screen>"
          };
        } else {
          wrapped_content = "" + "<screen" + ((function() {if ($truthy(informal)) {
            return common_attrs
          } else {
            return ""
          }; return nil; })()) + ">" + (node.$content()) + "</screen>"
        };
        if ($truthy(informal)) {
          return wrapped_content
        } else {
          return "" + "<formalpara" + (common_attrs) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + "<para>\n" + (wrapped_content) + "\n" + "</para>\n" + "</formalpara>"
        };
      }, TMP_DocBook5Converter_convert_listing_15.$$arity = 1);
      
      Opal.def(self, '$convert_literal', TMP_DocBook5Converter_convert_literal_16 = function $$convert_literal(node) {
        var self = this;

        if ($truthy(node['$title?']())) {
          return "" + "<formalpara" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + "<para>\n" + "<literallayout class=\"monospaced\">" + (node.$content()) + "</literallayout>\n" + "</para>\n" + "</formalpara>"
        } else {
          return "" + "<literallayout" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + " class=\"monospaced\">" + (node.$content()) + "</literallayout>"
        }
      }, TMP_DocBook5Converter_convert_literal_16.$$arity = 1);
      Opal.alias(self, "convert_pass", "content_only");
      
      Opal.def(self, '$convert_stem', TMP_DocBook5Converter_convert_stem_17 = function $$convert_stem(node) {
        var $a, self = this, idx = nil, equation = nil, equation_data = nil;

        
        if ($truthy((idx = node.$subs().$index("specialcharacters")))) {
          
          node.$subs().$delete_at(idx);
          equation = ($truthy($a = node.$content()) ? $a : "");
          if ($truthy($rb_gt(idx, 0))) {
            
            node.$subs().$insert(idx, "specialcharacters");
          } else {
            
            node.$subs().$unshift("specialcharacters");
          };
        } else {
          equation = ($truthy($a = node.$content()) ? $a : "")
        };
        if (node.$style()['$==']("asciimath")) {
          equation_data = (function() {if ($truthy(self['$asciimath_available?']())) {
            
            return $$$('::', 'AsciiMath').$parse(equation).$to_mathml("mml:", $hash2(["xmlns:mml"], {"xmlns:mml": "http://www.w3.org/1998/Math/MathML"}));
          } else {
            return "" + "<mathphrase><![CDATA[" + (equation) + "]]></mathphrase>"
          }; return nil; })()
        } else {
          equation_data = "" + "<alt><![CDATA[" + (equation) + "]]></alt>\n" + "<mathphrase><![CDATA[" + (equation) + "]]></mathphrase>"
        };
        if ($truthy(node['$title?']())) {
          return "" + "<equation" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + (equation_data) + "\n" + "</equation>"
        } else {
          return "" + "<informalequation" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (equation_data) + "\n" + "</informalequation>"
        };
      }, TMP_DocBook5Converter_convert_stem_17.$$arity = 1);
      
      Opal.def(self, '$convert_olist', TMP_DocBook5Converter_convert_olist_19 = function $$convert_olist(node) {
        var TMP_18, self = this, result = nil, num_attribute = nil, start_attribute = nil;

        
        result = [];
        num_attribute = (function() {if ($truthy(node.$style())) {
          return "" + " numeration=\"" + (node.$style()) + "\""
        } else {
          return ""
        }; return nil; })();
        start_attribute = (function() {if ($truthy(node['$attr?']("start"))) {
          return "" + " startingnumber=\"" + (node.$attr("start")) + "\""
        } else {
          return ""
        }; return nil; })();
        result['$<<']("" + "<orderedlist" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + (num_attribute) + (start_attribute) + ">");
        if ($truthy(node['$title?']())) {
          result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
        $send(node.$items(), 'each', [], (TMP_18 = function(item){var self = TMP_18.$$s || this;
if (item == null) item = nil;
        
          result['$<<']("" + "<listitem" + (self.$common_attributes(item.$id(), item.$role())) + ">");
          result['$<<']("" + "<simpara>" + (item.$text()) + "</simpara>");
          if ($truthy(item['$blocks?']())) {
            result['$<<'](item.$content())};
          return result['$<<']("</listitem>");}, TMP_18.$$s = self, TMP_18.$$arity = 1, TMP_18));
        result['$<<']("</orderedlist>");
        return result.$join($$($nesting, 'LF'));
      }, TMP_DocBook5Converter_convert_olist_19.$$arity = 1);
      
      Opal.def(self, '$convert_open', TMP_DocBook5Converter_convert_open_20 = function $$convert_open(node) {
        var $a, $b, self = this, $case = nil, id = nil, reftext = nil, role = nil, content_spacer = nil;

        return (function() {$case = node.$style();
        if ("abstract"['$===']($case)) {if ($truthy((($a = node.$parent()['$=='](node.$document())) ? node.$document().$doctype()['$==']("book") : node.$parent()['$=='](node.$document())))) {
          
          self.$logger().$warn("abstract block cannot be used in a document without a title when doctype is book. Excluding block content.");
          return "";
        } else {
          return "" + "<abstract>\n" + (self.$title_tag(node)) + (self.$enclose_content(node)) + "\n" + "</abstract>"
        }}
        else if ("partintro"['$===']($case)) {if ($truthy(($truthy($a = (($b = node.$level()['$=='](0)) ? node.$parent().$context()['$==']("section") : node.$level()['$=='](0))) ? node.$document().$doctype()['$==']("book") : $a))) {
          return "" + "<partintro" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$title_tag(node)) + (self.$enclose_content(node)) + "\n" + "</partintro>"
        } else {
          
          self.$logger().$error("partintro block can only be used when doctype is book and must be a child of a book part. Excluding block content.");
          return "";
        }}
        else {
        if ($truthy((id = node.$id()))) {
          reftext = node.$reftext()};
        role = node.$role();
        if ($truthy(node['$title?']())) {
          return "" + "<formalpara" + (self.$common_attributes(id, role, reftext)) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + "<para>" + ((content_spacer = (function() {if (node.$content_model()['$==']("compound")) {
            return $$($nesting, 'LF')
          } else {
            return ""
          }; return nil; })())) + (node.$content()) + (content_spacer) + "</para>\n" + "</formalpara>"
        } else if ($truthy(($truthy($a = id) ? $a : role))) {
          if (node.$content_model()['$==']("compound")) {
            return "" + "<para" + (self.$common_attributes(id, role, reftext)) + ">\n" + (node.$content()) + "\n" + "</para>"
          } else {
            return "" + "<simpara" + (self.$common_attributes(id, role, reftext)) + ">" + (node.$content()) + "</simpara>"
          }
        } else {
          return self.$enclose_content(node)
        };}})()
      }, TMP_DocBook5Converter_convert_open_20.$$arity = 1);
      
      Opal.def(self, '$convert_page_break', TMP_DocBook5Converter_convert_page_break_21 = function $$convert_page_break(node) {
        var self = this;

        return "<simpara><?asciidoc-pagebreak?></simpara>"
      }, TMP_DocBook5Converter_convert_page_break_21.$$arity = 1);
      
      Opal.def(self, '$convert_paragraph', TMP_DocBook5Converter_convert_paragraph_22 = function $$convert_paragraph(node) {
        var self = this;

        if ($truthy(node['$title?']())) {
          return "" + "<formalpara" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + "<para>" + (node.$content()) + "</para>\n" + "</formalpara>"
        } else {
          return "" + "<simpara" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">" + (node.$content()) + "</simpara>"
        }
      }, TMP_DocBook5Converter_convert_paragraph_22.$$arity = 1);
      
      Opal.def(self, '$convert_preamble', TMP_DocBook5Converter_convert_preamble_23 = function $$convert_preamble(node) {
        var self = this;

        if (node.$document().$doctype()['$==']("book")) {
          return "" + "<preface" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$title_tag(node, false)) + (node.$content()) + "\n" + "</preface>"
        } else {
          return node.$content()
        }
      }, TMP_DocBook5Converter_convert_preamble_23.$$arity = 1);
      
      Opal.def(self, '$convert_quote', TMP_DocBook5Converter_convert_quote_25 = function $$convert_quote(node) {
        var $a, TMP_24, self = this;

        return $send(self, 'blockquote_tag', [node, ($truthy($a = node['$has_role?']("epigraph")) ? "epigraph" : $a)], (TMP_24 = function(){var self = TMP_24.$$s || this;

        return self.$enclose_content(node)}, TMP_24.$$s = self, TMP_24.$$arity = 0, TMP_24))
      }, TMP_DocBook5Converter_convert_quote_25.$$arity = 1);
      
      Opal.def(self, '$convert_thematic_break', TMP_DocBook5Converter_convert_thematic_break_26 = function $$convert_thematic_break(node) {
        var self = this;

        return "<simpara><?asciidoc-hr?></simpara>"
      }, TMP_DocBook5Converter_convert_thematic_break_26.$$arity = 1);
      
      Opal.def(self, '$convert_sidebar', TMP_DocBook5Converter_convert_sidebar_27 = function $$convert_sidebar(node) {
        var self = this;

        return "" + "<sidebar" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$title_tag(node)) + (self.$enclose_content(node)) + "\n" + "</sidebar>"
      }, TMP_DocBook5Converter_convert_sidebar_27.$$arity = 1);
      
      Opal.def(self, '$convert_table', TMP_DocBook5Converter_convert_table_33 = function $$convert_table(node) {
        var TMP_28, TMP_29, TMP_30, self = this, has_body = nil, result = nil, pgwide_attribute = nil, frame = nil, grid = nil, tag_name = nil, col_width_key = nil, width = nil;

        
        has_body = false;
        result = [];
        pgwide_attribute = (function() {if ($truthy(node['$option?']("pgwide"))) {
          return " pgwide=\"1\""
        } else {
          return ""
        }; return nil; })();
        if ((frame = node.$attr("frame", "all", "table-frame"))['$==']("ends")) {
          frame = "topbot"};
        grid = node.$attr("grid", nil, "table-grid");
        result['$<<']("" + "<" + ((tag_name = (function() {if ($truthy(node['$title?']())) {
          return "table"
        } else {
          return "informaltable"
        }; return nil; })())) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + (pgwide_attribute) + " frame=\"" + (frame) + "\" rowsep=\"" + ((function() {if ($truthy(["none", "cols"]['$include?'](grid))) {
          return 0
        } else {
          return 1
        }; return nil; })()) + "\" colsep=\"" + ((function() {if ($truthy(["none", "rows"]['$include?'](grid))) {
          return 0
        } else {
          return 1
        }; return nil; })()) + "\"" + ((function() {if ($truthy(node['$attr?']("orientation", "landscape", "table-orientation"))) {
          return " orient=\"land\""
        } else {
          return ""
        }; return nil; })()) + ">");
        if ($truthy(node['$option?']("unbreakable"))) {
          result['$<<']("<?dbfo keep-together=\"always\"?>")
        } else if ($truthy(node['$option?']("breakable"))) {
          result['$<<']("<?dbfo keep-together=\"auto\"?>")};
        if (tag_name['$==']("table")) {
          result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
        col_width_key = (function() {if ($truthy((width = (function() {if ($truthy(node['$attr?']("width"))) {
          
          return node.$attr("width");
        } else {
          return nil
        }; return nil; })()))) {
          
          $send($$($nesting, 'TABLE_PI_NAMES'), 'each', [], (TMP_28 = function(pi_name){var self = TMP_28.$$s || this;
if (pi_name == null) pi_name = nil;
          return result['$<<']("" + "<?" + (pi_name) + " table-width=\"" + (width) + "\"?>")}, TMP_28.$$s = self, TMP_28.$$arity = 1, TMP_28));
          return "colabswidth";
        } else {
          return "colpcwidth"
        }; return nil; })();
        result['$<<']("" + "<tgroup cols=\"" + (node.$attr("colcount")) + "\">");
        $send(node.$columns(), 'each', [], (TMP_29 = function(col){var self = TMP_29.$$s || this;
if (col == null) col = nil;
        return result['$<<']("" + "<colspec colname=\"col_" + (col.$attr("colnumber")) + "\" colwidth=\"" + (col.$attr(col_width_key)) + "*\"/>")}, TMP_29.$$s = self, TMP_29.$$arity = 1, TMP_29));
        $send(node.$rows().$to_h(), 'each', [], (TMP_30 = function(tsec, rows){var self = TMP_30.$$s || this, TMP_31;
if (tsec == null) tsec = nil;if (rows == null) rows = nil;
        
          if ($truthy(rows['$empty?']())) {
            return nil;};
          if (tsec['$==']("body")) {
            has_body = true};
          result['$<<']("" + "<t" + (tsec) + ">");
          $send(rows, 'each', [], (TMP_31 = function(row){var self = TMP_31.$$s || this, TMP_32;
if (row == null) row = nil;
          
            result['$<<']("<row>");
            $send(row, 'each', [], (TMP_32 = function(cell){var self = TMP_32.$$s || this, halign_attribute = nil, valign_attribute = nil, colspan_attribute = nil, colnum = nil, rowspan_attribute = nil, entry_start = nil, cell_content = nil, $case = nil, entry_end = nil;
if (cell == null) cell = nil;
            
              halign_attribute = (function() {if ($truthy(cell['$attr?']("halign"))) {
                return "" + " align=\"" + (cell.$attr("halign")) + "\""
              } else {
                return ""
              }; return nil; })();
              valign_attribute = (function() {if ($truthy(cell['$attr?']("valign"))) {
                return "" + " valign=\"" + (cell.$attr("valign")) + "\""
              } else {
                return ""
              }; return nil; })();
              colspan_attribute = (function() {if ($truthy(cell.$colspan())) {
                return "" + " namest=\"col_" + ((colnum = cell.$column().$attr("colnumber"))) + "\" nameend=\"col_" + ($rb_minus($rb_plus(colnum, cell.$colspan()), 1)) + "\""
              } else {
                return ""
              }; return nil; })();
              rowspan_attribute = (function() {if ($truthy(cell.$rowspan())) {
                return "" + " morerows=\"" + ($rb_minus(cell.$rowspan(), 1)) + "\""
              } else {
                return ""
              }; return nil; })();
              entry_start = "" + "<entry" + (halign_attribute) + (valign_attribute) + (colspan_attribute) + (rowspan_attribute) + ">";
              if (tsec['$==']("head")) {
                cell_content = cell.$text()
              } else {
                $case = cell.$style();
                if ("asciidoc"['$===']($case)) {cell_content = cell.$content()}
                else if ("literal"['$===']($case)) {cell_content = "" + "<literallayout class=\"monospaced\">" + (cell.$text()) + "</literallayout>"}
                else if ("header"['$===']($case)) {cell_content = (function() {if ($truthy((cell_content = cell.$content())['$empty?']())) {
                  return ""
                } else {
                  return "" + "<simpara><emphasis role=\"strong\">" + (cell_content.$join("</emphasis></simpara><simpara><emphasis role=\"strong\">")) + "</emphasis></simpara>"
                }; return nil; })()}
                else {cell_content = (function() {if ($truthy((cell_content = cell.$content())['$empty?']())) {
                  return ""
                } else {
                  return "" + "<simpara>" + (cell_content.$join("</simpara><simpara>")) + "</simpara>"
                }; return nil; })()}
              };
              entry_end = (function() {if ($truthy(node.$document()['$attr?']("cellbgcolor"))) {
                return "" + "<?dbfo bgcolor=\"" + (node.$document().$attr("cellbgcolor")) + "\"?></entry>"
              } else {
                return "</entry>"
              }; return nil; })();
              return result['$<<']("" + (entry_start) + (cell_content) + (entry_end));}, TMP_32.$$s = self, TMP_32.$$arity = 1, TMP_32));
            return result['$<<']("</row>");}, TMP_31.$$s = self, TMP_31.$$arity = 1, TMP_31));
          return result['$<<']("" + "</t" + (tsec) + ">");}, TMP_30.$$s = self, TMP_30.$$arity = 2, TMP_30));
        result['$<<']("</tgroup>");
        result['$<<']("" + "</" + (tag_name) + ">");
        if ($truthy(has_body)) {
        } else {
          self.$logger().$warn("tables must have at least one body row")
        };
        return result.$join($$($nesting, 'LF'));
      }, TMP_DocBook5Converter_convert_table_33.$$arity = 1);
      Opal.alias(self, "convert_toc", "skip");
      
      Opal.def(self, '$convert_ulist', TMP_DocBook5Converter_convert_ulist_36 = function $$convert_ulist(node) {
        var TMP_34, TMP_35, self = this, result = nil, mark_type = nil, checklist = nil, mark_attribute = nil;

        
        result = [];
        if (node.$style()['$==']("bibliography")) {
          
          result['$<<']("" + "<bibliodiv" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">");
          if ($truthy(node['$title?']())) {
            result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
          $send(node.$items(), 'each', [], (TMP_34 = function(item){var self = TMP_34.$$s || this;
if (item == null) item = nil;
          
            result['$<<']("<bibliomixed>");
            result['$<<']("" + "<bibliomisc>" + (item.$text()) + "</bibliomisc>");
            if ($truthy(item['$blocks?']())) {
              result['$<<'](item.$content())};
            return result['$<<']("</bibliomixed>");}, TMP_34.$$s = self, TMP_34.$$arity = 1, TMP_34));
          result['$<<']("</bibliodiv>");
        } else {
          
          mark_type = (function() {if ($truthy((checklist = node['$option?']("checklist")))) {
            return "none"
          } else {
            return node.$style()
          }; return nil; })();
          mark_attribute = (function() {if ($truthy(mark_type)) {
            return "" + " mark=\"" + (mark_type) + "\""
          } else {
            return ""
          }; return nil; })();
          result['$<<']("" + "<itemizedlist" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + (mark_attribute) + ">");
          if ($truthy(node['$title?']())) {
            result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
          $send(node.$items(), 'each', [], (TMP_35 = function(item){var self = TMP_35.$$s || this, $a, text_marker = nil;
if (item == null) item = nil;
          
            if ($truthy(($truthy($a = checklist) ? item['$attr?']("checkbox") : $a))) {
              text_marker = (function() {if ($truthy(item['$attr?']("checked"))) {
                return "&#10003; "
              } else {
                return "&#10063; "
              }; return nil; })()};
            result['$<<']("" + "<listitem" + (self.$common_attributes(item.$id(), item.$role())) + ">");
            result['$<<']("" + "<simpara>" + (($truthy($a = text_marker) ? $a : "")) + (item.$text()) + "</simpara>");
            if ($truthy(item['$blocks?']())) {
              result['$<<'](item.$content())};
            return result['$<<']("</listitem>");}, TMP_35.$$s = self, TMP_35.$$arity = 1, TMP_35));
          result['$<<']("</itemizedlist>");
        };
        return result.$join($$($nesting, 'LF'));
      }, TMP_DocBook5Converter_convert_ulist_36.$$arity = 1);
      
      Opal.def(self, '$convert_verse', TMP_DocBook5Converter_convert_verse_38 = function $$convert_verse(node) {
        var $a, TMP_37, self = this;

        return $send(self, 'blockquote_tag', [node, ($truthy($a = node['$has_role?']("epigraph")) ? "epigraph" : $a)], (TMP_37 = function(){var self = TMP_37.$$s || this;

        return "" + "<literallayout>" + (node.$content()) + "</literallayout>"}, TMP_37.$$s = self, TMP_37.$$arity = 0, TMP_37))
      }, TMP_DocBook5Converter_convert_verse_38.$$arity = 1);
      Opal.alias(self, "convert_video", "skip");
      
      Opal.def(self, '$convert_inline_anchor', TMP_DocBook5Converter_convert_inline_anchor_39 = function $$convert_inline_anchor(node) {
        var $a, self = this, $case = nil, id = nil, path = nil, linkend = nil, text = nil;

        return (function() {$case = node.$type();
        if ("ref"['$===']($case)) {return "" + "<anchor" + (self.$common_attributes((id = node.$id()), nil, ($truthy($a = node.$reftext()) ? $a : "" + "[" + (id) + "]"))) + "/>"}
        else if ("xref"['$===']($case)) {if ($truthy((path = node.$attributes()['$[]']("path")))) {
          return "" + "<link xl:href=\"" + (node.$target()) + "\">" + (($truthy($a = node.$text()) ? $a : path)) + "</link>"
        } else {
          
          linkend = ($truthy($a = node.$attributes()['$[]']("fragment")) ? $a : node.$target());
          if ($truthy((text = node.$text()))) {
            return "" + "<link linkend=\"" + (linkend) + "\">" + (text) + "</link>"
          } else {
            return "" + "<xref linkend=\"" + (linkend) + "\"/>"
          };
        }}
        else if ("link"['$===']($case)) {return "" + "<link xl:href=\"" + (node.$target()) + "\">" + (node.$text()) + "</link>"}
        else if ("bibref"['$===']($case)) {return "" + "<anchor" + (self.$common_attributes(node.$id(), nil, "" + "[" + (($truthy($a = node.$reftext()) ? $a : node.$id())) + "]")) + "/>" + (text)}
        else {
        self.$logger().$warn("" + "unknown anchor type: " + (node.$type().$inspect()));
        return nil;}})()
      }, TMP_DocBook5Converter_convert_inline_anchor_39.$$arity = 1);
      
      Opal.def(self, '$convert_inline_break', TMP_DocBook5Converter_convert_inline_break_40 = function $$convert_inline_break(node) {
        var self = this;

        return "" + (node.$text()) + "<?asciidoc-br?>"
      }, TMP_DocBook5Converter_convert_inline_break_40.$$arity = 1);
      
      Opal.def(self, '$convert_inline_button', TMP_DocBook5Converter_convert_inline_button_41 = function $$convert_inline_button(node) {
        var self = this;

        return "" + "<guibutton>" + (node.$text()) + "</guibutton>"
      }, TMP_DocBook5Converter_convert_inline_button_41.$$arity = 1);
      
      Opal.def(self, '$convert_inline_callout', TMP_DocBook5Converter_convert_inline_callout_42 = function $$convert_inline_callout(node) {
        var self = this;

        return "" + "<co" + (self.$common_attributes(node.$id())) + "/>"
      }, TMP_DocBook5Converter_convert_inline_callout_42.$$arity = 1);
      
      Opal.def(self, '$convert_inline_footnote', TMP_DocBook5Converter_convert_inline_footnote_43 = function $$convert_inline_footnote(node) {
        var self = this;

        if (node.$type()['$==']("xref")) {
          return "" + "<footnoteref linkend=\"" + (node.$target()) + "\"/>"
        } else {
          return "" + "<footnote" + (self.$common_attributes(node.$id())) + "><simpara>" + (node.$text()) + "</simpara></footnote>"
        }
      }, TMP_DocBook5Converter_convert_inline_footnote_43.$$arity = 1);
      
      Opal.def(self, '$convert_inline_image', TMP_DocBook5Converter_convert_inline_image_44 = function $$convert_inline_image(node) {
        var self = this, width_attribute = nil, depth_attribute = nil;

        
        width_attribute = (function() {if ($truthy(node['$attr?']("width"))) {
          return "" + " contentwidth=\"" + (node.$attr("width")) + "\""
        } else {
          return ""
        }; return nil; })();
        depth_attribute = (function() {if ($truthy(node['$attr?']("height"))) {
          return "" + " contentdepth=\"" + (node.$attr("height")) + "\""
        } else {
          return ""
        }; return nil; })();
        return "" + "<inlinemediaobject>\n" + "<imageobject>\n" + "<imagedata fileref=\"" + ((function() {if (node.$type()['$==']("icon")) {
          
          return node.$icon_uri(node.$target());
        } else {
          
          return node.$image_uri(node.$target());
        }; return nil; })()) + "\"" + (width_attribute) + (depth_attribute) + "/>\n" + "</imageobject>\n" + "<textobject><phrase>" + (node.$alt()) + "</phrase></textobject>\n" + "</inlinemediaobject>";
      }, TMP_DocBook5Converter_convert_inline_image_44.$$arity = 1);
      
      Opal.def(self, '$convert_inline_indexterm', TMP_DocBook5Converter_convert_inline_indexterm_46 = function $$convert_inline_indexterm(node) {
        var TMP_45, self = this, see = nil, rel = nil, see_also_list = nil, numterms = nil, terms = nil;

        
        if ($truthy((see = node.$attr("see")))) {
          rel = "" + "\n<see>" + (see) + "</see>"
        } else if ($truthy((see_also_list = node.$attr("see-also")))) {
          rel = $send(see_also_list, 'map', [], (TMP_45 = function(see_also){var self = TMP_45.$$s || this;
if (see_also == null) see_also = nil;
          return "" + "\n<seealso>" + (see_also) + "</seealso>"}, TMP_45.$$s = self, TMP_45.$$arity = 1, TMP_45)).$join()
        } else {
          rel = ""
        };
        if (node.$type()['$==']("visible")) {
          return "" + "<indexterm>\n" + "<primary>" + (node.$text()) + "</primary>" + (rel) + "\n" + "</indexterm>" + (node.$text())
        } else if ($truthy($rb_gt((numterms = (terms = node.$attr("terms")).$size()), 2))) {
          return "" + "<indexterm>\n" + "<primary>" + (terms['$[]'](0)) + "</primary><secondary>" + (terms['$[]'](1)) + "</secondary><tertiary>" + (terms['$[]'](2)) + "</tertiary>" + (rel) + "\n" + "</indexterm>" + ((function() {if ($truthy(node.$document()['$option?']("indexterm-promotion"))) {
            return "" + "\n" + "<indexterm>\n" + "<primary>" + (terms['$[]'](1)) + "</primary><secondary>" + (terms['$[]'](2)) + "</secondary>\n" + "</indexterm>\n" + "<indexterm>\n" + "<primary>" + (terms['$[]'](2)) + "</primary>\n" + "</indexterm>"
          } else {
            return ""
          }; return nil; })())
        } else if ($truthy($rb_gt(numterms, 1))) {
          return "" + "<indexterm>\n" + "<primary>" + (terms['$[]'](0)) + "</primary><secondary>" + (terms['$[]'](1)) + "</secondary>" + (rel) + "\n" + "</indexterm>" + ((function() {if ($truthy(node.$document()['$option?']("indexterm-promotion"))) {
            return "" + "\n" + "<indexterm>\n" + "<primary>" + (terms['$[]'](1)) + "</primary>\n" + "</indexterm>"
          } else {
            return ""
          }; return nil; })())
        } else {
          return "" + "<indexterm>\n" + "<primary>" + (terms['$[]'](0)) + "</primary>" + (rel) + "\n" + "</indexterm>"
        };
      }, TMP_DocBook5Converter_convert_inline_indexterm_46.$$arity = 1);
      
      Opal.def(self, '$convert_inline_kbd', TMP_DocBook5Converter_convert_inline_kbd_47 = function $$convert_inline_kbd(node) {
        var self = this, keys = nil;

        if ((keys = node.$attr("keys")).$size()['$=='](1)) {
          return "" + "<keycap>" + (keys['$[]'](0)) + "</keycap>"
        } else {
          return "" + "<keycombo><keycap>" + (keys.$join("</keycap><keycap>")) + "</keycap></keycombo>"
        }
      }, TMP_DocBook5Converter_convert_inline_kbd_47.$$arity = 1);
      
      Opal.def(self, '$convert_inline_menu', TMP_DocBook5Converter_convert_inline_menu_48 = function $$convert_inline_menu(node) {
        var self = this, menu = nil, submenus = nil, menuitem = nil;

        
        menu = node.$attr("menu");
        if ($truthy((submenus = node.$attr("submenus"))['$empty?']())) {
          if ($truthy((menuitem = node.$attr("menuitem")))) {
            return "" + "<menuchoice><guimenu>" + (menu) + "</guimenu> <guimenuitem>" + (menuitem) + "</guimenuitem></menuchoice>"
          } else {
            return "" + "<guimenu>" + (menu) + "</guimenu>"
          }
        } else {
          return "" + "<menuchoice><guimenu>" + (menu) + "</guimenu> <guisubmenu>" + (submenus.$join("</guisubmenu> <guisubmenu>")) + "</guisubmenu> <guimenuitem>" + (node.$attr("menuitem")) + "</guimenuitem></menuchoice>"
        };
      }, TMP_DocBook5Converter_convert_inline_menu_48.$$arity = 1);
      
      Opal.def(self, '$convert_inline_quoted', TMP_DocBook5Converter_convert_inline_quoted_49 = function $$convert_inline_quoted(node) {
        var $a, $b, self = this, type = nil, equation = nil, open = nil, close = nil, supports_phrase = nil, text = nil, quoted_text = nil;

        if ((type = node.$type())['$==']("asciimath")) {
          if ($truthy(self['$asciimath_available?']())) {
            return "" + "<inlineequation>" + ($$$('::', 'AsciiMath').$parse(node.$text()).$to_mathml("mml:", $hash2(["xmlns:mml"], {"xmlns:mml": "http://www.w3.org/1998/Math/MathML"}))) + "</inlineequation>"
          } else {
            return "" + "<inlineequation><mathphrase><![CDATA[" + (node.$text()) + "]]></mathphrase></inlineequation>"
          }
        } else if (type['$==']("latexmath")) {
          return "" + "<inlineequation><alt><![CDATA[" + ((equation = node.$text())) + "]]></alt><mathphrase><![CDATA[" + (equation) + "]]></mathphrase></inlineequation>"
        } else {
          
          $b = $$($nesting, 'QUOTE_TAGS')['$[]'](type), $a = Opal.to_ary($b), (open = ($a[0] == null ? nil : $a[0])), (close = ($a[1] == null ? nil : $a[1])), (supports_phrase = ($a[2] == null ? nil : $a[2])), $b;
          text = node.$text();
          if ($truthy(node.$role())) {
            if ($truthy(supports_phrase)) {
              quoted_text = "" + (open) + "<phrase role=\"" + (node.$role()) + "\">" + (text) + "</phrase>" + (close)
            } else {
              quoted_text = "" + (open.$chop()) + " role=\"" + (node.$role()) + "\">" + (text) + (close)
            }
          } else {
            quoted_text = "" + (open) + (text) + (close)
          };
          if ($truthy(node.$id())) {
            return "" + "<anchor" + (self.$common_attributes(node.$id(), nil, text)) + "/>" + (quoted_text)
          } else {
            return quoted_text
          };
        }
      }, TMP_DocBook5Converter_convert_inline_quoted_49.$$arity = 1);
      self.$private();
      
      Opal.def(self, '$common_attributes', TMP_DocBook5Converter_common_attributes_50 = function $$common_attributes(id, role, reftext) {
        var $a, self = this, attrs = nil;

        if (role == null) {
          role = nil;
        }
        if (reftext == null) {
          reftext = nil;
        }
        
        if ($truthy(id)) {
          attrs = "" + " xml:id=\"" + (id) + "\"" + ((function() {if ($truthy(role)) {
            return "" + " role=\"" + (role) + "\""
          } else {
            return ""
          }; return nil; })())
        } else if ($truthy(role)) {
          attrs = "" + " role=\"" + (role) + "\""
        } else {
          attrs = ""
        };
        if ($truthy(reftext)) {
          
          if ($truthy(($truthy($a = reftext['$include?']("<")) ? (reftext = reftext.$gsub($$($nesting, 'XmlSanitizeRx'), ""))['$include?'](" ") : $a))) {
            reftext = reftext.$squeeze(" ").$strip()};
          if ($truthy(reftext['$include?']("\""))) {
            reftext = reftext.$gsub("\"", "&quot;")};
          return "" + (attrs) + " xreflabel=\"" + (reftext) + "\"";
        } else {
          return attrs
        };
      }, TMP_DocBook5Converter_common_attributes_50.$$arity = -2);
      
      Opal.def(self, '$author_tag', TMP_DocBook5Converter_author_tag_51 = function $$author_tag(doc, author) {
        var self = this, result = nil;

        
        result = [];
        result['$<<']("<author>");
        result['$<<']("<personname>");
        if ($truthy(author.$firstname())) {
          result['$<<']("" + "<firstname>" + (doc.$sub_replacements(author.$firstname())) + "</firstname>")};
        if ($truthy(author.$middlename())) {
          result['$<<']("" + "<othername>" + (doc.$sub_replacements(author.$middlename())) + "</othername>")};
        if ($truthy(author.$lastname())) {
          result['$<<']("" + "<surname>" + (doc.$sub_replacements(author.$lastname())) + "</surname>")};
        result['$<<']("</personname>");
        if ($truthy(author.$email())) {
          result['$<<']("" + "<email>" + (author.$email()) + "</email>")};
        result['$<<']("</author>");
        return result.$join($$($nesting, 'LF'));
      }, TMP_DocBook5Converter_author_tag_51.$$arity = 2);
      
      Opal.def(self, '$document_info_tag', TMP_DocBook5Converter_document_info_tag_54 = function $$document_info_tag(doc) {
        var $a, TMP_52, $b, TMP_53, self = this, result = nil, title = nil, date = nil, authors = nil, author = nil, back_cover_tag = nil, front_cover_tag = nil, docinfo_content = nil;

        
        result = ["<info>"];
        if ($truthy(doc.$notitle())) {
        } else if ($truthy((title = doc.$doctitle($hash2(["partition", "use_fallback"], {"partition": true, "use_fallback": true})))['$subtitle?']())) {
          result['$<<']("" + "<title>" + (title.$main()) + "</title>\n" + "<subtitle>" + (title.$subtitle()) + "</subtitle>")
        } else {
          result['$<<']("" + "<title>" + (title) + "</title>")
        };
        if ($truthy((date = (function() {if ($truthy(doc['$attr?']("revdate"))) {
          
          return doc.$attr("revdate");
        } else {
          
          if ($truthy(doc['$attr?']("reproducible"))) {
            return nil
          } else {
            
            return doc.$attr("docdate");
          };
        }; return nil; })()))) {
          result['$<<']("" + "<date>" + (date) + "</date>")};
        if ($truthy(doc['$attr?']("copyright"))) {
          
          $$($nesting, 'CopyrightRx')['$=~'](doc.$attr("copyright"));
          result['$<<']("<copyright>");
          result['$<<']("" + "<holder>" + ((($a = $gvars['~']) === nil ? nil : $a['$[]'](1))) + "</holder>");
          if ($truthy((($a = $gvars['~']) === nil ? nil : $a['$[]'](2)))) {
            result['$<<']("" + "<year>" + ((($a = $gvars['~']) === nil ? nil : $a['$[]'](2))) + "</year>")};
          result['$<<']("</copyright>");};
        if ($truthy(doc['$header?']())) {
          
          if ($truthy((authors = doc.$authors())['$empty?']())) {
          } else if ($truthy($rb_gt(authors.$size(), 1))) {
            
            result['$<<']("<authorgroup>");
            $send(authors, 'each', [], (TMP_52 = function(author){var self = TMP_52.$$s || this;
if (author == null) author = nil;
            return result['$<<'](self.$author_tag(doc, author))}, TMP_52.$$s = self, TMP_52.$$arity = 1, TMP_52));
            result['$<<']("</authorgroup>");
          } else {
            
            result['$<<'](self.$author_tag(doc, (author = authors['$[]'](0))));
            if ($truthy(author.$initials())) {
              result['$<<']("" + "<authorinitials>" + (author.$initials()) + "</authorinitials>")};
          };
          if ($truthy(($truthy($a = doc['$attr?']("revdate")) ? ($truthy($b = doc['$attr?']("revnumber")) ? $b : doc['$attr?']("revremark")) : $a))) {
            
            result['$<<']("" + "<revhistory>\n" + "<revision>");
            if ($truthy(doc['$attr?']("revnumber"))) {
              result['$<<']("" + "<revnumber>" + (doc.$attr("revnumber")) + "</revnumber>")};
            if ($truthy(doc['$attr?']("revdate"))) {
              result['$<<']("" + "<date>" + (doc.$attr("revdate")) + "</date>")};
            if ($truthy(doc['$attr?']("authorinitials"))) {
              result['$<<']("" + "<authorinitials>" + (doc.$attr("authorinitials")) + "</authorinitials>")};
            if ($truthy(doc['$attr?']("revremark"))) {
              result['$<<']("" + "<revremark>" + (doc.$attr("revremark")) + "</revremark>")};
            result['$<<']("" + "</revision>\n" + "</revhistory>");};
          if ($truthy(($truthy($a = doc['$attr?']("front-cover-image")) ? $a : doc['$attr?']("back-cover-image")))) {
            if ($truthy((back_cover_tag = self.$cover_tag(doc, "back")))) {
              
              result['$<<'](self.$cover_tag(doc, "front", true));
              result['$<<'](back_cover_tag);
            } else if ($truthy((front_cover_tag = self.$cover_tag(doc, "front")))) {
              result['$<<'](front_cover_tag)}};
          if ($truthy(doc['$attr?']("orgname"))) {
            result['$<<']("" + "<orgname>" + (doc.$attr("orgname")) + "</orgname>")};
          if ($truthy((docinfo_content = doc.$docinfo())['$empty?']())) {
          } else {
            result['$<<'](docinfo_content)
          };};
        result['$<<']("</info>");
        if (doc.$doctype()['$==']("manpage")) {
          
          result['$<<']("<refmeta>");
          if ($truthy(doc['$attr?']("mantitle"))) {
            result['$<<']("" + "<refentrytitle>" + (doc.$attr("mantitle")) + "</refentrytitle>")};
          if ($truthy(doc['$attr?']("manvolnum"))) {
            result['$<<']("" + "<manvolnum>" + (doc.$attr("manvolnum")) + "</manvolnum>")};
          result['$<<']("" + "<refmiscinfo class=\"source\">" + (doc.$attr("mansource", "&#160;")) + "</refmiscinfo>");
          result['$<<']("" + "<refmiscinfo class=\"manual\">" + (doc.$attr("manmanual", "&#160;")) + "</refmiscinfo>");
          result['$<<']("</refmeta>");
          result['$<<']("<refnamediv>");
          if ($truthy(doc['$attr?']("mannames"))) {
            result = $rb_plus(result, $send(doc.$attr("mannames"), 'map', [], (TMP_53 = function(n){var self = TMP_53.$$s || this;
if (n == null) n = nil;
            return "" + "<refname>" + (n) + "</refname>"}, TMP_53.$$s = self, TMP_53.$$arity = 1, TMP_53)))};
          if ($truthy(doc['$attr?']("manpurpose"))) {
            result['$<<']("" + "<refpurpose>" + (doc.$attr("manpurpose")) + "</refpurpose>")};
          result['$<<']("</refnamediv>");};
        return result.$join($$($nesting, 'LF'));
      }, TMP_DocBook5Converter_document_info_tag_54.$$arity = 1);
      
      Opal.def(self, '$enclose_content', TMP_DocBook5Converter_enclose_content_55 = function $$enclose_content(node) {
        var self = this;

        if (node.$content_model()['$==']("compound")) {
          return node.$content()
        } else {
          return "" + "<simpara>" + (node.$content()) + "</simpara>"
        }
      }, TMP_DocBook5Converter_enclose_content_55.$$arity = 1);
      
      Opal.def(self, '$title_tag', TMP_DocBook5Converter_title_tag_56 = function $$title_tag(node, optional) {
        var $a, self = this;

        if (optional == null) {
          optional = true;
        }
        if ($truthy(($truthy($a = optional['$!']()) ? $a : node['$title?']()))) {
          return "" + "<title>" + (node.$title()) + "</title>\n"
        } else {
          return ""
        }
      }, TMP_DocBook5Converter_title_tag_56.$$arity = -2);
      
      Opal.def(self, '$cover_tag', TMP_DocBook5Converter_cover_tag_57 = function $$cover_tag(doc, face, use_placeholder) {
        var $a, self = this, cover_image = nil, width_attr = nil, depth_attr = nil, attrs = nil;

        if (use_placeholder == null) {
          use_placeholder = false;
        }
        if ($truthy((cover_image = doc.$attr("" + (face) + "-cover-image")))) {
          
          width_attr = "";
          depth_attr = "";
          if ($truthy(($truthy($a = cover_image['$include?'](":")) ? $$($nesting, 'ImageMacroRx')['$=~'](cover_image) : $a))) {
            
            cover_image = doc.$image_uri((($a = $gvars['~']) === nil ? nil : $a['$[]'](1)));
            if ($truthy((($a = $gvars['~']) === nil ? nil : $a['$[]'](2))['$empty?']())) {
            } else {
              
              attrs = $$($nesting, 'AttributeList').$new((($a = $gvars['~']) === nil ? nil : $a['$[]'](2))).$parse(["alt", "width", "height"]);
              if ($truthy(attrs['$key?']("scaledwidth"))) {
                width_attr = "" + " width=\"" + (attrs['$[]']("scaledwidth")) + "\""
              } else {
                
                if ($truthy(attrs['$key?']("width"))) {
                  width_attr = "" + " contentwidth=\"" + (attrs['$[]']("width")) + "\""};
                if ($truthy(attrs['$key?']("height"))) {
                  depth_attr = "" + " contentdepth=\"" + (attrs['$[]']("height")) + "\""};
              };
            };};
          return "" + "<cover role=\"" + (face) + "\">\n" + "<mediaobject>\n" + "<imageobject>\n" + "<imagedata fileref=\"" + (cover_image) + "\"" + (width_attr) + (depth_attr) + "/>\n" + "</imageobject>\n" + "</mediaobject>\n" + "</cover>";
        } else if ($truthy(use_placeholder)) {
          return "" + "<cover role=\"" + (face) + "\"/>"
        } else {
          return nil
        }
      }, TMP_DocBook5Converter_cover_tag_57.$$arity = -3);
      
      Opal.def(self, '$blockquote_tag', TMP_DocBook5Converter_blockquote_tag_58 = function $$blockquote_tag(node, tag_name) {
        var $a, self = this, $iter = TMP_DocBook5Converter_blockquote_tag_58.$$p, $yield = $iter || nil, start_tag = nil, end_tag = nil, result = nil;

        if (tag_name == null) {
          tag_name = nil;
        }
        if ($iter) TMP_DocBook5Converter_blockquote_tag_58.$$p = null;
        
        if ($truthy(tag_name)) {
          $a = ["" + "<" + (tag_name), "" + "</" + (tag_name) + ">"], (start_tag = $a[0]), (end_tag = $a[1]), $a
        } else {
          $a = ["<blockquote", "</blockquote>"], (start_tag = $a[0]), (end_tag = $a[1]), $a
        };
        result = ["" + (start_tag) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">"];
        if ($truthy(node['$title?']())) {
          result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
        if ($truthy(($truthy($a = node['$attr?']("attribution")) ? $a : node['$attr?']("citetitle")))) {
          
          result['$<<']("<attribution>");
          if ($truthy(node['$attr?']("attribution"))) {
            result['$<<'](node.$attr("attribution"))};
          if ($truthy(node['$attr?']("citetitle"))) {
            result['$<<']("" + "<citetitle>" + (node.$attr("citetitle")) + "</citetitle>")};
          result['$<<']("</attribution>");};
        result['$<<'](Opal.yieldX($yield, []));
        result['$<<'](end_tag);
        return result.$join($$($nesting, 'LF'));
      }, TMP_DocBook5Converter_blockquote_tag_58.$$arity = -2);
      
      Opal.def(self, '$asciimath_available?', TMP_DocBook5Converter_asciimath_available$q_59 = function() {
        var $a, self = this;

        return (self.asciimath_status = ($truthy($a = self.asciimath_status) ? $a : self.$load_asciimath()))['$==']("loaded")
      }, TMP_DocBook5Converter_asciimath_available$q_59.$$arity = 0);
      return (Opal.def(self, '$load_asciimath', TMP_DocBook5Converter_load_asciimath_60 = function $$load_asciimath() {
        var $a, $b, $c, $d, self = this;

        if ($truthy(((($a = $$$('::', 'AsciiMath', 'skip_raise')) && ($b = $a, $b) && ($c = $b) && ((($d = $c.$parse) && !$d.$$stub) || $c['$respond_to_missing?']('parse'))) ? 'method' : nil))) {
          return "loaded"
        } else if ($truthy($$($nesting, 'Helpers').$require_library("asciimath", true, "warn")['$nil?']())) {
          return "unavailable"
        } else {
          return "loaded"
        }
      }, TMP_DocBook5Converter_load_asciimath_60.$$arity = 0), nil) && 'load_asciimath';
    })($$($nesting, 'Converter'), $$$($$($nesting, 'Converter'), 'Base'), $nesting)
  })($nesting[0], $nesting)
})(Opal);


  return {};
}));
