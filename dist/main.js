// UMD Module
(function (root, factory) {
  if (typeof module === 'object' && module.exports) {
    // Node. Does not work with strict CommonJS, but
    // only CommonJS-like environments that support module.exports,
    // like Node.
    module.exports = factory;
  } else if (typeof define === 'function' && define.amd) {
    // AMD. Register a named module.
    define('asciidoctor/docbook', ['asciidoctor'], function () {
      return factory();
    });
  } else {
    // Browser globals (root is window)
    if (typeof root.Asciidoctor === 'undefined') {
      throw new Error('Asciidoctor.js should be loaded before Asciidoctor DocBook.js');
    }
    root.Asciidoctor.DocBook = factory;
  }
}(this, function () {
/* Generated by Opal 0.11.1.dev */
Opal.modules["asciidoctor/converter/docbook5"] = function(Opal) {
  function $rb_times(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs * rhs : lhs['$*'](rhs);
  }
  function $rb_minus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs - rhs : lhs['$-'](rhs);
  }
  function $rb_gt(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs > rhs : lhs['$>'](rhs);
  }
  function $rb_plus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs + rhs : lhs['$+'](rhs);
  }
  function $rb_lt(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs < rhs : lhs['$<'](rhs);
  }
  var self = Opal.top, $nesting = [], nil = Opal.nil, $$$ = Opal.const_get_qualified, $$ = Opal.const_get_relative, $breaker = Opal.breaker, $slice = Opal.slice, $module = Opal.module, $klass = Opal.klass, $truthy = Opal.truthy, $hash2 = Opal.hash2, $send = Opal.send, $gvars = Opal.gvars;

  Opal.add_stubs(['$==', '$doctype', '$<<', '$doctype_declaration', '$attr?', '$attr', '$lang_attribute_name', '$document_ns_attributes', '$noheader', '$document_info_tag', '$blocks?', '$content', '$empty?', '$docinfo', '$*', '$document', '$[]', '$sectname', '$special', '$option?', '$title', '$common_attributes', '$id', '$role', '$reftext', '$title_tag', '$resolve_content', '$title?', '$each', '$items', '$text', '$default=', '$-', '$style', '$text?', '$level', '$image_uri', '$alt', '$!', '$index', '$subs', '$delete_at', '$>', '$insert', '$unshift', '$nil?', '$require_library', '$to_mathml', '$parse', '$===', '$parent', '$warn', '$logger', '$context', '$error', '$content_model', '$blockquote_tag', '$has_role?', '$include?', '$columns', '$by_section', '$rows', '$colspan', '$column', '$+', '$rowspan', '$type', '$attributes', '$target', '$inspect', '$icon_uri', '$size', '$chop', '$gsub', '$strip', '$squeeze', '$notitle', '$document_title_tags', '$doctitle', '$=~', '$has_header?', '$<', '$to_i', '$author_tag', '$times', '$cover_tag', '$map', '$subtitle?', '$main', '$subtitle', '$new', '$key?']);
  return (function($base, $parent_nesting) {
    function $Asciidoctor() {};
    var self = $Asciidoctor = $module($base, 'Asciidoctor', $Asciidoctor);

    var def = self.prototype, $nesting = [self].concat($parent_nesting);

    (function($base, $super, $parent_nesting) {
      function $DocBook5Converter(){};
      var self = $DocBook5Converter = $klass($base, $super, 'DocBook5Converter', $DocBook5Converter);

      var def = self.prototype, $nesting = [self].concat($parent_nesting), TMP_DocBook5Converter_document_1, TMP_DocBook5Converter_section_2, TMP_DocBook5Converter_admonition_3, TMP_DocBook5Converter_colist_5, TMP_DocBook5Converter_dlist_10, TMP_DocBook5Converter_example_11, TMP_DocBook5Converter_floating_title_12, TMP_DocBook5Converter_image_13, TMP_DocBook5Converter_listing_14, TMP_DocBook5Converter_literal_15, TMP_DocBook5Converter_stem_16, TMP_DocBook5Converter_olist_18, TMP_DocBook5Converter_open_19, TMP_DocBook5Converter_page_break_20, TMP_DocBook5Converter_paragraph_21, TMP_DocBook5Converter_preamble_22, TMP_DocBook5Converter_quote_24, TMP_DocBook5Converter_thematic_break_25, TMP_DocBook5Converter_sidebar_26, TMP_DocBook5Converter_table_32, TMP_DocBook5Converter_ulist_35, TMP_DocBook5Converter_verse_37, TMP_DocBook5Converter_inline_anchor_38, TMP_DocBook5Converter_inline_break_39, TMP_DocBook5Converter_inline_button_40, TMP_DocBook5Converter_inline_callout_41, TMP_DocBook5Converter_inline_footnote_42, TMP_DocBook5Converter_inline_image_43, TMP_DocBook5Converter_inline_indexterm_44, TMP_DocBook5Converter_inline_kbd_45, TMP_DocBook5Converter_inline_menu_46, TMP_DocBook5Converter_inline_quoted_47, TMP_DocBook5Converter_common_attributes_48, TMP_DocBook5Converter_doctype_declaration_49, TMP_DocBook5Converter_author_tag_50, TMP_DocBook5Converter_document_info_tag_53, TMP_DocBook5Converter_document_ns_attributes_54, TMP_DocBook5Converter_lang_attribute_name_55, TMP_DocBook5Converter_document_title_tags_56, TMP_DocBook5Converter_resolve_content_57, TMP_DocBook5Converter_title_tag_58, TMP_DocBook5Converter_cover_tag_59, TMP_DocBook5Converter_blockquote_tag_60, $writer = nil;

      def.asciimath = nil;
      
      Opal.const_set($nesting[0], 'CopyrightRx', /^(.+?)(?: ((?:\d{4}\-)?\d{4}))?$/);
      Opal.const_set($nesting[0], 'ImageMacroRx', /^image::?(.+?)\[(.*?)\]$/);
      
      Opal.def(self, '$document', TMP_DocBook5Converter_document_1 = function $$document(node) {
        var self = this, result = nil, root_tag_name = nil, doctype_line = nil, lang_attribute = nil, footer_docinfo = nil;

        
        result = [];
        if ((root_tag_name = node.$doctype())['$==']("manpage")) {
          root_tag_name = "refentry"};
        result['$<<']("<?xml version=\"1.0\" encoding=\"UTF-8\"?>");
        if ($truthy((doctype_line = self.$doctype_declaration(root_tag_name)))) {
          result['$<<'](doctype_line)};
        if ($truthy(node['$attr?']("toc"))) {
          if ($truthy(node['$attr?']("toclevels"))) {
            result['$<<']("" + "<?asciidoc-toc maxdepth=\"" + (node.$attr("toclevels")) + "\"?>")
          } else {
            result['$<<']("<?asciidoc-toc?>")
          }};
        if ($truthy(node['$attr?']("sectnums"))) {
          if ($truthy(node['$attr?']("sectnumlevels"))) {
            result['$<<']("" + "<?asciidoc-numbered maxdepth=\"" + (node.$attr("sectnumlevels")) + "\"?>")
          } else {
            result['$<<']("<?asciidoc-numbered?>")
          }};
        lang_attribute = (function() {if ($truthy(node['$attr?']("nolang"))) {
          return ""
        } else {
          return "" + " " + (self.$lang_attribute_name()) + "=\"" + (node.$attr("lang", "en")) + "\""
        }; return nil; })();
        result['$<<']("" + "<" + (root_tag_name) + (self.$document_ns_attributes(node)) + (lang_attribute) + ">");
        if ($truthy(node.$noheader())) {
        } else {
          result['$<<'](self.$document_info_tag(node, root_tag_name))
        };
        if ($truthy(node['$blocks?']())) {
          result['$<<'](node.$content())};
        if ($truthy((footer_docinfo = node.$docinfo("footer"))['$empty?']())) {
        } else {
          result['$<<'](footer_docinfo)
        };
        result['$<<']("" + "</" + (root_tag_name) + ">");
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_document_1.$$arity = 1);
      Opal.alias(self, "embedded", "content");
      Opal.const_set($nesting[0], 'MANPAGE_SECTION_TAGS', $hash2(["section", "synopsis"], {"section": "refsection", "synopsis": "refsynopsisdiv"}));
      
      Opal.def(self, '$section', TMP_DocBook5Converter_section_2 = function $$section(node) {
        var $a, self = this, tag_name = nil, title_el = nil;

        
        if (node.$document().$doctype()['$==']("manpage")) {
          tag_name = ($truthy($a = $$($nesting, 'MANPAGE_SECTION_TAGS')['$[]']((tag_name = node.$sectname()))) ? $a : tag_name)
        } else {
          tag_name = node.$sectname()
        };
        title_el = (function() {if ($truthy(($truthy($a = node.$special()) ? node['$option?']("untitled") : $a))) {
          return ""
        } else {
          return "" + "<title>" + (node.$title()) + "</title>\n"
        }; return nil; })();
        return "" + "<" + (tag_name) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (title_el) + (node.$content()) + "\n" + "</" + (tag_name) + ">";
      }, TMP_DocBook5Converter_section_2.$$arity = 1);
      
      Opal.def(self, '$admonition', TMP_DocBook5Converter_admonition_3 = function $$admonition(node) {
        var self = this, tag_name = nil;

        return "" + "<" + ((tag_name = node.$attr("name"))) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$title_tag(node)) + (self.$resolve_content(node)) + "\n" + "</" + (tag_name) + ">"
      }, TMP_DocBook5Converter_admonition_3.$$arity = 1);
      Opal.alias(self, "audio", "skip");
      
      Opal.def(self, '$colist', TMP_DocBook5Converter_colist_5 = function $$colist(node) {
        var TMP_4, self = this, result = nil;

        
        result = [];
        result['$<<']("" + "<calloutlist" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">");
        if ($truthy(node['$title?']())) {
          result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
        $send(node.$items(), 'each', [], (TMP_4 = function(item){var self = TMP_4.$$s || this;
if (item == null) item = nil;
        
          result['$<<']("" + "<callout arearefs=\"" + (item.$attr("coids")) + "\">");
          result['$<<']("" + "<para>" + (item.$text()) + "</para>");
          if ($truthy(item['$blocks?']())) {
            result['$<<'](item.$content())};
          return result['$<<']("</callout>");}, TMP_4.$$s = self, TMP_4.$$arity = 1, TMP_4));
        result['$<<']("</calloutlist>");
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_colist_5.$$arity = 1);
      
      $writer = [$hash2(["list", "entry", "term", "item"], {"list": "variablelist", "entry": "varlistentry", "term": "term", "item": "listitem"})];
      $send(Opal.const_set($nesting[0], 'DLIST_TAGS', $hash2(["qanda", "glossary"], {"qanda": $hash2(["list", "entry", "label", "term", "item"], {"list": "qandaset", "entry": "qandaentry", "label": "question", "term": "simpara", "item": "answer"}), "glossary": $hash2(["list", "entry", "term", "item"], {"list": nil, "entry": "glossentry", "term": "glossterm", "item": "glossdef"})})), 'default=', Opal.to_a($writer));
      $writer[$rb_minus($writer["length"], 1)];;
      
      Opal.def(self, '$dlist', TMP_DocBook5Converter_dlist_10 = function $$dlist(node) {
        var TMP_6, TMP_8, self = this, result = nil, tag_name = nil, tags = nil, list_tag = nil, entry_tag = nil, label_tag = nil, term_tag = nil, item_tag = nil;

        
        result = [];
        if (node.$style()['$==']("horizontal")) {
          
          result['$<<']("" + "<" + ((tag_name = (function() {if ($truthy(node['$title?']())) {
            return "table"
          } else {
            return "informaltable"
          }; return nil; })())) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + " tabstyle=\"horizontal\" frame=\"none\" colsep=\"0\" rowsep=\"0\">\n" + (self.$title_tag(node)) + "<tgroup cols=\"2\">\n" + "<colspec colwidth=\"" + (node.$attr("labelwidth", 15)) + "*\"/>\n" + "<colspec colwidth=\"" + (node.$attr("itemwidth", 85)) + "*\"/>\n" + "<tbody valign=\"top\">");
          $send(node.$items(), 'each', [], (TMP_6 = function(terms, dd){var self = TMP_6.$$s || this, TMP_7;
if (terms == null) terms = nil;if (dd == null) dd = nil;
          
            result['$<<']("" + "<row>\n" + "<entry>");
            $send([].concat(Opal.to_a(terms)), 'each', [], (TMP_7 = function(dt){var self = TMP_7.$$s || this;
if (dt == null) dt = nil;
            return result['$<<']("" + "<simpara>" + (dt.$text()) + "</simpara>")}, TMP_7.$$s = self, TMP_7.$$arity = 1, TMP_7));
            result['$<<']("" + "</entry>\n" + "<entry>");
            if ($truthy(dd)) {
              
              if ($truthy(dd['$text?']())) {
                result['$<<']("" + "<simpara>" + (dd.$text()) + "</simpara>")};
              if ($truthy(dd['$blocks?']())) {
                result['$<<'](dd.$content())};};
            return result['$<<']("" + "</entry>\n" + "</row>");}, TMP_6.$$s = self, TMP_6.$$arity = 2, TMP_6));
          result['$<<']("" + "</tbody>\n" + "</tgroup>\n" + "</" + (tag_name) + ">");
        } else {
          
          tags = $$($nesting, 'DLIST_TAGS')['$[]'](node.$style());
          list_tag = tags['$[]']("list");
          entry_tag = tags['$[]']("entry");
          label_tag = tags['$[]']("label");
          term_tag = tags['$[]']("term");
          item_tag = tags['$[]']("item");
          if ($truthy(list_tag)) {
            
            result['$<<']("" + "<" + (list_tag) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">");
            if ($truthy(node['$title?']())) {
              result['$<<']("" + "<title>" + (node.$title()) + "</title>")};};
          $send(node.$items(), 'each', [], (TMP_8 = function(terms, dd){var self = TMP_8.$$s || this, TMP_9;
if (terms == null) terms = nil;if (dd == null) dd = nil;
          
            result['$<<']("" + "<" + (entry_tag) + ">");
            if ($truthy(label_tag)) {
              result['$<<']("" + "<" + (label_tag) + ">")};
            $send([].concat(Opal.to_a(terms)), 'each', [], (TMP_9 = function(dt){var self = TMP_9.$$s || this;
if (dt == null) dt = nil;
            return result['$<<']("" + "<" + (term_tag) + ">" + (dt.$text()) + "</" + (term_tag) + ">")}, TMP_9.$$s = self, TMP_9.$$arity = 1, TMP_9));
            if ($truthy(label_tag)) {
              result['$<<']("" + "</" + (label_tag) + ">")};
            result['$<<']("" + "<" + (item_tag) + ">");
            if ($truthy(dd)) {
              
              if ($truthy(dd['$text?']())) {
                result['$<<']("" + "<simpara>" + (dd.$text()) + "</simpara>")};
              if ($truthy(dd['$blocks?']())) {
                result['$<<'](dd.$content())};};
            result['$<<']("" + "</" + (item_tag) + ">");
            return result['$<<']("" + "</" + (entry_tag) + ">");}, TMP_8.$$s = self, TMP_8.$$arity = 2, TMP_8));
          if ($truthy(list_tag)) {
            result['$<<']("" + "</" + (list_tag) + ">")};
        };
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_dlist_10.$$arity = 1);
      
      Opal.def(self, '$example', TMP_DocBook5Converter_example_11 = function $$example(node) {
        var self = this;

        if ($truthy(node['$title?']())) {
          return "" + "<example" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + (self.$resolve_content(node)) + "\n" + "</example>"
        } else {
          return "" + "<informalexample" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$resolve_content(node)) + "\n" + "</informalexample>"
        }
      }, TMP_DocBook5Converter_example_11.$$arity = 1);
      
      Opal.def(self, '$floating_title', TMP_DocBook5Converter_floating_title_12 = function $$floating_title(node) {
        var self = this;

        return "" + "<bridgehead" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + " renderas=\"sect" + (node.$level()) + "\">" + (node.$title()) + "</bridgehead>"
      }, TMP_DocBook5Converter_floating_title_12.$$arity = 1);
      
      Opal.def(self, '$image', TMP_DocBook5Converter_image_13 = function $$image(node) {
        var self = this, width_attribute = nil, depth_attribute = nil, scale_attribute = nil, align_attribute = nil, mediaobject = nil;

        
        if ($truthy(node['$attr?']("scaledwidth"))) {
          
          width_attribute = "" + " width=\"" + (node.$attr("scaledwidth")) + "\"";
          depth_attribute = "";
          scale_attribute = "";
        } else if ($truthy(node['$attr?']("scale"))) {
          scale_attribute = "" + " scale=\"" + (node.$attr("scale")) + "\""
        } else {
          
          width_attribute = (function() {if ($truthy(node['$attr?']("width"))) {
            return "" + " contentwidth=\"" + (node.$attr("width")) + "\""
          } else {
            return ""
          }; return nil; })();
          depth_attribute = (function() {if ($truthy(node['$attr?']("height"))) {
            return "" + " contentdepth=\"" + (node.$attr("height")) + "\""
          } else {
            return ""
          }; return nil; })();
          scale_attribute = "";
        };
        align_attribute = (function() {if ($truthy(node['$attr?']("align"))) {
          return "" + " align=\"" + (node.$attr("align")) + "\""
        } else {
          return ""
        }; return nil; })();
        mediaobject = "" + "<mediaobject>\n" + "<imageobject>\n" + "<imagedata fileref=\"" + (node.$image_uri(node.$attr("target"))) + "\"" + (width_attribute) + (depth_attribute) + (scale_attribute) + (align_attribute) + "/>\n" + "</imageobject>\n" + "<textobject><phrase>" + (node.$alt()) + "</phrase></textobject>\n" + "</mediaobject>";
        if ($truthy(node['$title?']())) {
          return "" + "<figure" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + (mediaobject) + "\n" + "</figure>"
        } else {
          return "" + "<informalfigure" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (mediaobject) + "\n" + "</informalfigure>"
        };
      }, TMP_DocBook5Converter_image_13.$$arity = 1);
      
      Opal.def(self, '$listing', TMP_DocBook5Converter_listing_14 = function $$listing(node) {
        var $a, self = this, informal = nil, listing_attributes = nil, numbering = nil, listing_content = nil;

        
        informal = node['$title?']()['$!']();
        listing_attributes = self.$common_attributes(node.$id(), node.$role(), node.$reftext());
        if ($truthy((($a = node.$style()['$==']("source")) ? node['$attr?']("language") : node.$style()['$==']("source")))) {
          
          numbering = (function() {if ($truthy(node['$attr?']("linenums", nil, false))) {
            return "numbered"
          } else {
            return "unnumbered"
          }; return nil; })();
          listing_content = "" + "<programlisting" + ((function() {if ($truthy(informal)) {
            return listing_attributes
          } else {
            return ""
          }; return nil; })()) + " language=\"" + (node.$attr("language", "", false)) + "\" linenumbering=\"" + (numbering) + "\">" + (node.$content()) + "</programlisting>";
        } else {
          listing_content = "" + "<screen" + ((function() {if ($truthy(informal)) {
            return listing_attributes
          } else {
            return ""
          }; return nil; })()) + ">" + (node.$content()) + "</screen>"
        };
        if ($truthy(informal)) {
          return listing_content
        } else {
          return "" + "<formalpara" + (listing_attributes) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + "<para>\n" + (listing_content) + "\n" + "</para>\n" + "</formalpara>"
        };
      }, TMP_DocBook5Converter_listing_14.$$arity = 1);
      
      Opal.def(self, '$literal', TMP_DocBook5Converter_literal_15 = function $$literal(node) {
        var self = this;

        if ($truthy(node['$title?']())) {
          return "" + "<formalpara" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + "<para>\n" + "<literallayout class=\"monospaced\">" + (node.$content()) + "</literallayout>\n" + "</para>\n" + "</formalpara>"
        } else {
          return "" + "<literallayout" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + " class=\"monospaced\">" + (node.$content()) + "</literallayout>"
        }
      }, TMP_DocBook5Converter_literal_15.$$arity = 1);
      
      Opal.def(self, '$stem', TMP_DocBook5Converter_stem_16 = function $$stem(node) {
        var $a, $b, $c, self = this, idx = nil, equation = nil, equation_data = nil;

        
        if ($truthy((idx = node.$subs().$index("specialcharacters")))) {
          
          node.$subs().$delete_at(idx);
          equation = node.$content();
          if ($truthy($rb_gt(idx, 0))) {
            
            node.$subs().$insert(idx, "specialcharacters");
          } else {
            
            node.$subs().$unshift("specialcharacters");
          };
        } else {
          equation = node.$content()
        };
        if (node.$style()['$==']("asciimath")) {
          if ((self.asciimath = ($truthy($a = self.asciimath) ? $a : (function() {if ($truthy(($truthy($b = (($c = $$$('::', 'AsciiMath', 'skip_raise')) ? 'constant' : nil)) ? $b : $$($nesting, 'Helpers').$require_library("asciimath", true, "warn"))['$nil?']())) {
            return "unavailable"
          } else {
            return "loaded"
          }; return nil; })()))['$==']("loaded")) {
            equation_data = $$$('::', 'AsciiMath').$parse(equation).$to_mathml("mml:", $hash2(["xmlns:mml"], {"xmlns:mml": "http://www.w3.org/1998/Math/MathML"}))
          } else {
            equation_data = "" + "<mathphrase><![CDATA[" + (equation) + "]]></mathphrase>"
          }
        } else {
          equation_data = "" + "<alt><![CDATA[" + (equation) + "]]></alt>\n" + "<mathphrase><![CDATA[" + (equation) + "]]></mathphrase>"
        };
        if ($truthy(node['$title?']())) {
          return "" + "<equation" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + (equation_data) + "\n" + "</equation>"
        } else {
          return "" + "<informalequation" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (equation_data) + "\n" + "</informalequation>"
        };
      }, TMP_DocBook5Converter_stem_16.$$arity = 1);
      
      Opal.def(self, '$olist', TMP_DocBook5Converter_olist_18 = function $$olist(node) {
        var TMP_17, self = this, result = nil, num_attribute = nil, start_attribute = nil;

        
        result = [];
        num_attribute = (function() {if ($truthy(node.$style())) {
          return "" + " numeration=\"" + (node.$style()) + "\""
        } else {
          return ""
        }; return nil; })();
        start_attribute = (function() {if ($truthy(node['$attr?']("start"))) {
          return "" + " startingnumber=\"" + (node.$attr("start")) + "\""
        } else {
          return ""
        }; return nil; })();
        result['$<<']("" + "<orderedlist" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + (num_attribute) + (start_attribute) + ">");
        if ($truthy(node['$title?']())) {
          result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
        $send(node.$items(), 'each', [], (TMP_17 = function(item){var self = TMP_17.$$s || this;
if (item == null) item = nil;
        
          result['$<<']("<listitem>");
          result['$<<']("" + "<simpara>" + (item.$text()) + "</simpara>");
          if ($truthy(item['$blocks?']())) {
            result['$<<'](item.$content())};
          return result['$<<']("</listitem>");}, TMP_17.$$s = self, TMP_17.$$arity = 1, TMP_17));
        result['$<<']("</orderedlist>");
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_olist_18.$$arity = 1);
      
      Opal.def(self, '$open', TMP_DocBook5Converter_open_19 = function $$open(node) {
        var $a, $b, self = this, $case = nil, id = nil, reftext = nil, role = nil, content_spacer = nil;

        return (function() {$case = node.$style();
        if ("abstract"['$===']($case)) {if ($truthy((($a = node.$parent()['$=='](node.$document())) ? node.$document().$doctype()['$==']("book") : node.$parent()['$=='](node.$document())))) {
          
          self.$logger().$warn("abstract block cannot be used in a document without a title when doctype is book. Excluding block content.");
          return "";
        } else {
          return "" + "<abstract>\n" + (self.$title_tag(node)) + (self.$resolve_content(node)) + "\n" + "</abstract>"
        }}
        else if ("partintro"['$===']($case)) {if ($truthy(($truthy($a = (($b = node.$level()['$=='](0)) ? node.$parent().$context()['$==']("section") : node.$level()['$=='](0))) ? node.$document().$doctype()['$==']("book") : $a))) {
          return "" + "<partintro" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$title_tag(node)) + (self.$resolve_content(node)) + "\n" + "</partintro>"
        } else {
          
          self.$logger().$error("partintro block can only be used when doctype is book and must be a child of a book part. Excluding block content.");
          return "";
        }}
        else {
        if ($truthy((id = node.$id()))) {
          reftext = node.$reftext()};
        role = node.$role();
        if ($truthy(node['$title?']())) {
          return "" + "<formalpara" + (self.$common_attributes(id, role, reftext)) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + "<para>" + ((content_spacer = (function() {if (node.$content_model()['$==']("compound")) {
            return $$($nesting, 'LF')
          } else {
            return ""
          }; return nil; })())) + (node.$content()) + (content_spacer) + "</para>\n" + "</formalpara>"
        } else if ($truthy(($truthy($a = id) ? $a : role))) {
          if (node.$content_model()['$==']("compound")) {
            return "" + "<para" + (self.$common_attributes(id, role, reftext)) + ">\n" + (node.$content()) + "\n" + "</para>"
          } else {
            return "" + "<simpara" + (self.$common_attributes(id, role, reftext)) + ">" + (node.$content()) + "</simpara>"
          }
        } else {
          return self.$resolve_content(node)
        };}})()
      }, TMP_DocBook5Converter_open_19.$$arity = 1);
      
      Opal.def(self, '$page_break', TMP_DocBook5Converter_page_break_20 = function $$page_break(node) {
        var self = this;

        return "<simpara><?asciidoc-pagebreak?></simpara>"
      }, TMP_DocBook5Converter_page_break_20.$$arity = 1);
      
      Opal.def(self, '$paragraph', TMP_DocBook5Converter_paragraph_21 = function $$paragraph(node) {
        var self = this;

        if ($truthy(node['$title?']())) {
          return "" + "<formalpara" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + "<para>" + (node.$content()) + "</para>\n" + "</formalpara>"
        } else {
          return "" + "<simpara" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">" + (node.$content()) + "</simpara>"
        }
      }, TMP_DocBook5Converter_paragraph_21.$$arity = 1);
      
      Opal.def(self, '$preamble', TMP_DocBook5Converter_preamble_22 = function $$preamble(node) {
        var self = this;

        if (node.$document().$doctype()['$==']("book")) {
          return "" + "<preface" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$title_tag(node, false)) + (node.$content()) + "\n" + "</preface>"
        } else {
          return node.$content()
        }
      }, TMP_DocBook5Converter_preamble_22.$$arity = 1);
      
      Opal.def(self, '$quote', TMP_DocBook5Converter_quote_24 = function $$quote(node) {
        var $a, TMP_23, self = this;

        return $send(self, 'blockquote_tag', [node, ($truthy($a = node['$has_role?']("epigraph")) ? "epigraph" : $a)], (TMP_23 = function(){var self = TMP_23.$$s || this;

        return self.$resolve_content(node)}, TMP_23.$$s = self, TMP_23.$$arity = 0, TMP_23))
      }, TMP_DocBook5Converter_quote_24.$$arity = 1);
      
      Opal.def(self, '$thematic_break', TMP_DocBook5Converter_thematic_break_25 = function $$thematic_break(node) {
        var self = this;

        return "<simpara><?asciidoc-hr?></simpara>"
      }, TMP_DocBook5Converter_thematic_break_25.$$arity = 1);
      
      Opal.def(self, '$sidebar', TMP_DocBook5Converter_sidebar_26 = function $$sidebar(node) {
        var self = this;

        return "" + "<sidebar" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$title_tag(node)) + (self.$resolve_content(node)) + "\n" + "</sidebar>"
      }, TMP_DocBook5Converter_sidebar_26.$$arity = 1);
      Opal.const_set($nesting[0], 'TABLE_PI_NAMES', ["dbhtml", "dbfo", "dblatex"]);
      
      Opal.def(self, '$table', TMP_DocBook5Converter_table_32 = function $$table(node) {
        var TMP_27, TMP_28, TMP_29, self = this, has_body = nil, result = nil, pgwide_attribute = nil, frame = nil, tag_name = nil, col_width_key = nil, width = nil;

        
        has_body = false;
        result = [];
        pgwide_attribute = (function() {if ($truthy(node['$option?']("pgwide"))) {
          return " pgwide=\"1\""
        } else {
          return ""
        }; return nil; })();
        if ((frame = node.$attr("frame", "all"))['$==']("ends")) {
          frame = "topbot"};
        result['$<<']("" + "<" + ((tag_name = (function() {if ($truthy(node['$title?']())) {
          return "table"
        } else {
          return "informaltable"
        }; return nil; })())) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + (pgwide_attribute) + " frame=\"" + (frame) + "\" rowsep=\"" + ((function() {if ($truthy(["none", "cols"]['$include?'](node.$attr("grid")))) {
          return 0
        } else {
          return 1
        }; return nil; })()) + "\" colsep=\"" + ((function() {if ($truthy(["none", "rows"]['$include?'](node.$attr("grid")))) {
          return 0
        } else {
          return 1
        }; return nil; })()) + "\"" + ((function() {if ($truthy(node['$attr?']("orientation", "landscape", false))) {
          return " orient=\"land\""
        } else {
          return ""
        }; return nil; })()) + ">");
        if ($truthy(node['$option?']("unbreakable"))) {
          result['$<<']("<?dbfo keep-together=\"always\"?>")
        } else if ($truthy(node['$option?']("breakable"))) {
          result['$<<']("<?dbfo keep-together=\"auto\"?>")};
        if (tag_name['$==']("table")) {
          result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
        col_width_key = (function() {if ($truthy((width = (function() {if ($truthy(node['$attr?']("width"))) {
          
          return node.$attr("width");
        } else {
          return nil
        }; return nil; })()))) {
          
          $send($$($nesting, 'TABLE_PI_NAMES'), 'each', [], (TMP_27 = function(pi_name){var self = TMP_27.$$s || this;
if (pi_name == null) pi_name = nil;
          return result['$<<']("" + "<?" + (pi_name) + " table-width=\"" + (width) + "\"?>")}, TMP_27.$$s = self, TMP_27.$$arity = 1, TMP_27));
          return "colabswidth";
        } else {
          return "colpcwidth"
        }; return nil; })();
        result['$<<']("" + "<tgroup cols=\"" + (node.$attr("colcount")) + "\">");
        $send(node.$columns(), 'each', [], (TMP_28 = function(col){var self = TMP_28.$$s || this;
if (col == null) col = nil;
        return result['$<<']("" + "<colspec colname=\"col_" + (col.$attr("colnumber")) + "\" colwidth=\"" + (col.$attr(col_width_key)) + "*\"/>")}, TMP_28.$$s = self, TMP_28.$$arity = 1, TMP_28));
        $send(node.$rows().$by_section(), 'each', [], (TMP_29 = function(tsec, rows){var self = TMP_29.$$s || this, TMP_30;
if (tsec == null) tsec = nil;if (rows == null) rows = nil;
        
          if ($truthy(rows['$empty?']())) {
            return nil;};
          if (tsec['$==']("body")) {
            has_body = true};
          result['$<<']("" + "<t" + (tsec) + ">");
          $send(rows, 'each', [], (TMP_30 = function(row){var self = TMP_30.$$s || this, TMP_31;
if (row == null) row = nil;
          
            result['$<<']("<row>");
            $send(row, 'each', [], (TMP_31 = function(cell){var self = TMP_31.$$s || this, halign_attribute = nil, valign_attribute = nil, colspan_attribute = nil, colnum = nil, rowspan_attribute = nil, entry_start = nil, cell_content = nil, $case = nil, entry_end = nil;
if (cell == null) cell = nil;
            
              halign_attribute = (function() {if ($truthy(cell['$attr?']("halign"))) {
                return "" + " align=\"" + (cell.$attr("halign")) + "\""
              } else {
                return ""
              }; return nil; })();
              valign_attribute = (function() {if ($truthy(cell['$attr?']("valign"))) {
                return "" + " valign=\"" + (cell.$attr("valign")) + "\""
              } else {
                return ""
              }; return nil; })();
              colspan_attribute = (function() {if ($truthy(cell.$colspan())) {
                return "" + " namest=\"col_" + ((colnum = cell.$column().$attr("colnumber"))) + "\" nameend=\"col_" + ($rb_minus($rb_plus(colnum, cell.$colspan()), 1)) + "\""
              } else {
                return ""
              }; return nil; })();
              rowspan_attribute = (function() {if ($truthy(cell.$rowspan())) {
                return "" + " morerows=\"" + ($rb_minus(cell.$rowspan(), 1)) + "\""
              } else {
                return ""
              }; return nil; })();
              entry_start = "" + "<entry" + (halign_attribute) + (valign_attribute) + (colspan_attribute) + (rowspan_attribute) + ">";
              if (tsec['$==']("head")) {
                cell_content = cell.$text()
              } else {
                $case = cell.$style();
                if ("asciidoc"['$===']($case)) {cell_content = cell.$content()}
                else if ("verse"['$===']($case)) {cell_content = "" + "<literallayout>" + (cell.$text()) + "</literallayout>"}
                else if ("literal"['$===']($case)) {cell_content = "" + "<literallayout class=\"monospaced\">" + (cell.$text()) + "</literallayout>"}
                else if ("header"['$===']($case)) {cell_content = (function() {if ($truthy((cell_content = cell.$content())['$empty?']())) {
                  return ""
                } else {
                  return "" + "<simpara><emphasis role=\"strong\">" + ($rb_times(cell_content, "</emphasis></simpara><simpara><emphasis role=\"strong\">")) + "</emphasis></simpara>"
                }; return nil; })()}
                else {cell_content = (function() {if ($truthy((cell_content = cell.$content())['$empty?']())) {
                  return ""
                } else {
                  return "" + "<simpara>" + ($rb_times(cell_content, "</simpara><simpara>")) + "</simpara>"
                }; return nil; })()}
              };
              entry_end = (function() {if ($truthy(node.$document()['$attr?']("cellbgcolor"))) {
                return "" + "<?dbfo bgcolor=\"" + (node.$document().$attr("cellbgcolor")) + "\"?></entry>"
              } else {
                return "</entry>"
              }; return nil; })();
              return result['$<<']("" + (entry_start) + (cell_content) + (entry_end));}, TMP_31.$$s = self, TMP_31.$$arity = 1, TMP_31));
            return result['$<<']("</row>");}, TMP_30.$$s = self, TMP_30.$$arity = 1, TMP_30));
          return result['$<<']("" + "</t" + (tsec) + ">");}, TMP_29.$$s = self, TMP_29.$$arity = 2, TMP_29));
        result['$<<']("</tgroup>");
        result['$<<']("" + "</" + (tag_name) + ">");
        if ($truthy(has_body)) {
        } else {
          self.$logger().$warn("tables must have at least one body row")
        };
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_table_32.$$arity = 1);
      Opal.alias(self, "toc", "skip");
      
      Opal.def(self, '$ulist', TMP_DocBook5Converter_ulist_35 = function $$ulist(node) {
        var TMP_33, TMP_34, self = this, result = nil, mark_type = nil, checklist = nil, mark_attribute = nil;

        
        result = [];
        if (node.$style()['$==']("bibliography")) {
          
          result['$<<']("" + "<bibliodiv" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">");
          if ($truthy(node['$title?']())) {
            result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
          $send(node.$items(), 'each', [], (TMP_33 = function(item){var self = TMP_33.$$s || this;
if (item == null) item = nil;
          
            result['$<<']("<bibliomixed>");
            result['$<<']("" + "<bibliomisc>" + (item.$text()) + "</bibliomisc>");
            if ($truthy(item['$blocks?']())) {
              result['$<<'](item.$content())};
            return result['$<<']("</bibliomixed>");}, TMP_33.$$s = self, TMP_33.$$arity = 1, TMP_33));
          result['$<<']("</bibliodiv>");
        } else {
          
          mark_type = (function() {if ($truthy((checklist = node['$option?']("checklist")))) {
            return "none"
          } else {
            return node.$style()
          }; return nil; })();
          mark_attribute = (function() {if ($truthy(mark_type)) {
            return "" + " mark=\"" + (mark_type) + "\""
          } else {
            return ""
          }; return nil; })();
          result['$<<']("" + "<itemizedlist" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + (mark_attribute) + ">");
          if ($truthy(node['$title?']())) {
            result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
          $send(node.$items(), 'each', [], (TMP_34 = function(item){var self = TMP_34.$$s || this, $a, text_marker = nil;
if (item == null) item = nil;
          
            text_marker = (function() {if ($truthy(($truthy($a = checklist) ? item['$attr?']("checkbox") : $a))) {
              if ($truthy(item['$attr?']("checked"))) {
                return "&#10003; "
              } else {
                return "&#10063; "
              }
            } else {
              return ""
            }; return nil; })();
            result['$<<']("<listitem>");
            result['$<<']("" + "<simpara>" + (text_marker) + (item.$text()) + "</simpara>");
            if ($truthy(item['$blocks?']())) {
              result['$<<'](item.$content())};
            return result['$<<']("</listitem>");}, TMP_34.$$s = self, TMP_34.$$arity = 1, TMP_34));
          result['$<<']("</itemizedlist>");
        };
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_ulist_35.$$arity = 1);
      
      Opal.def(self, '$verse', TMP_DocBook5Converter_verse_37 = function $$verse(node) {
        var $a, TMP_36, self = this;

        return $send(self, 'blockquote_tag', [node, ($truthy($a = node['$has_role?']("epigraph")) ? "epigraph" : $a)], (TMP_36 = function(){var self = TMP_36.$$s || this;

        return "" + "<literallayout>" + (node.$content()) + "</literallayout>"}, TMP_36.$$s = self, TMP_36.$$arity = 0, TMP_36))
      }, TMP_DocBook5Converter_verse_37.$$arity = 1);
      Opal.alias(self, "video", "skip");
      
      Opal.def(self, '$inline_anchor', TMP_DocBook5Converter_inline_anchor_38 = function $$inline_anchor(node) {
        var $a, self = this, $case = nil, id = nil, path = nil, linkend = nil, text = nil;

        return (function() {$case = node.$type();
        if ("ref"['$===']($case)) {return "" + "<anchor" + (self.$common_attributes((id = node.$id()), nil, ($truthy($a = node.$reftext()) ? $a : "" + "[" + (id) + "]"))) + "/>"}
        else if ("xref"['$===']($case)) {if ($truthy((path = node.$attributes()['$[]']("path")))) {
          return "" + "<link xl:href=\"" + (node.$target()) + "\">" + (($truthy($a = node.$text()) ? $a : path)) + "</link>"
        } else {
          
          linkend = ($truthy($a = node.$attributes()['$[]']("fragment")) ? $a : node.$target());
          if ($truthy((text = node.$text()))) {
            return "" + "<link linkend=\"" + (linkend) + "\">" + (text) + "</link>"
          } else {
            return "" + "<xref linkend=\"" + (linkend) + "\"/>"
          };
        }}
        else if ("link"['$===']($case)) {return "" + "<link xl:href=\"" + (node.$target()) + "\">" + (node.$text()) + "</link>"}
        else if ("bibref"['$===']($case)) {return "" + "<anchor" + (self.$common_attributes(node.$id(), nil, (text = node.$text()))) + "/>" + (text)}
        else {
        self.$logger().$warn("" + "unknown anchor type: " + (node.$type().$inspect()));
        return nil;}})()
      }, TMP_DocBook5Converter_inline_anchor_38.$$arity = 1);
      
      Opal.def(self, '$inline_break', TMP_DocBook5Converter_inline_break_39 = function $$inline_break(node) {
        var self = this;

        return "" + (node.$text()) + "<?asciidoc-br?>"
      }, TMP_DocBook5Converter_inline_break_39.$$arity = 1);
      
      Opal.def(self, '$inline_button', TMP_DocBook5Converter_inline_button_40 = function $$inline_button(node) {
        var self = this;

        return "" + "<guibutton>" + (node.$text()) + "</guibutton>"
      }, TMP_DocBook5Converter_inline_button_40.$$arity = 1);
      
      Opal.def(self, '$inline_callout', TMP_DocBook5Converter_inline_callout_41 = function $$inline_callout(node) {
        var self = this;

        return "" + "<co" + (self.$common_attributes(node.$id())) + "/>"
      }, TMP_DocBook5Converter_inline_callout_41.$$arity = 1);
      
      Opal.def(self, '$inline_footnote', TMP_DocBook5Converter_inline_footnote_42 = function $$inline_footnote(node) {
        var self = this;

        if (node.$type()['$==']("xref")) {
          return "" + "<footnoteref linkend=\"" + (node.$target()) + "\"/>"
        } else {
          return "" + "<footnote" + (self.$common_attributes(node.$id())) + "><simpara>" + (node.$text()) + "</simpara></footnote>"
        }
      }, TMP_DocBook5Converter_inline_footnote_42.$$arity = 1);
      
      Opal.def(self, '$inline_image', TMP_DocBook5Converter_inline_image_43 = function $$inline_image(node) {
        var self = this, width_attribute = nil, depth_attribute = nil;

        
        width_attribute = (function() {if ($truthy(node['$attr?']("width"))) {
          return "" + " contentwidth=\"" + (node.$attr("width")) + "\""
        } else {
          return ""
        }; return nil; })();
        depth_attribute = (function() {if ($truthy(node['$attr?']("height"))) {
          return "" + " contentdepth=\"" + (node.$attr("height")) + "\""
        } else {
          return ""
        }; return nil; })();
        return "" + "<inlinemediaobject>\n" + "<imageobject>\n" + "<imagedata fileref=\"" + ((function() {if (node.$type()['$==']("icon")) {
          
          return node.$icon_uri(node.$target());
        } else {
          
          return node.$image_uri(node.$target());
        }; return nil; })()) + "\"" + (width_attribute) + (depth_attribute) + "/>\n" + "</imageobject>\n" + "<textobject><phrase>" + (node.$alt()) + "</phrase></textobject>\n" + "</inlinemediaobject>";
      }, TMP_DocBook5Converter_inline_image_43.$$arity = 1);
      
      Opal.def(self, '$inline_indexterm', TMP_DocBook5Converter_inline_indexterm_44 = function $$inline_indexterm(node) {
        var self = this, terms = nil, result = nil, numterms = nil;

        if (node.$type()['$==']("visible")) {
          return "" + "<indexterm><primary>" + (node.$text()) + "</primary></indexterm>" + (node.$text())
        } else {
          
          terms = node.$attr("terms");
          result = [];
          if ($truthy($rb_gt((numterms = terms.$size()), 2))) {
            result['$<<']("" + "<indexterm>\n" + "<primary>" + (terms['$[]'](0)) + "</primary><secondary>" + (terms['$[]'](1)) + "</secondary><tertiary>" + (terms['$[]'](2)) + "</tertiary>\n" + "</indexterm>")};
          if ($truthy($rb_gt(numterms, 1))) {
            result['$<<']("" + "<indexterm>\n" + "<primary>" + (terms['$[]'](-2)) + "</primary><secondary>" + (terms['$[]'](-1)) + "</secondary>\n" + "</indexterm>")};
          result['$<<']("" + "<indexterm>\n" + "<primary>" + (terms['$[]'](-1)) + "</primary>\n" + "</indexterm>");
          return $rb_times(result, $$($nesting, 'LF'));
        }
      }, TMP_DocBook5Converter_inline_indexterm_44.$$arity = 1);
      
      Opal.def(self, '$inline_kbd', TMP_DocBook5Converter_inline_kbd_45 = function $$inline_kbd(node) {
        var self = this, keys = nil;

        if ((keys = node.$attr("keys")).$size()['$=='](1)) {
          return "" + "<keycap>" + (keys['$[]'](0)) + "</keycap>"
        } else {
          return "" + "<keycombo><keycap>" + ($rb_times(keys, "</keycap><keycap>")) + "</keycap></keycombo>"
        }
      }, TMP_DocBook5Converter_inline_kbd_45.$$arity = 1);
      
      Opal.def(self, '$inline_menu', TMP_DocBook5Converter_inline_menu_46 = function $$inline_menu(node) {
        var self = this, menu = nil, submenus = nil, menuitem = nil;

        
        menu = node.$attr("menu");
        if ($truthy((submenus = node.$attr("submenus"))['$empty?']())) {
          if ($truthy((menuitem = node.$attr("menuitem", nil, false)))) {
            return "" + "<menuchoice><guimenu>" + (menu) + "</guimenu> <guimenuitem>" + (menuitem) + "</guimenuitem></menuchoice>"
          } else {
            return "" + "<guimenu>" + (menu) + "</guimenu>"
          }
        } else {
          return "" + "<menuchoice><guimenu>" + (menu) + "</guimenu> <guisubmenu>" + ($rb_times(submenus, "</guisubmenu> <guisubmenu>")) + "</guisubmenu> <guimenuitem>" + (node.$attr("menuitem")) + "</guimenuitem></menuchoice>"
        };
      }, TMP_DocBook5Converter_inline_menu_46.$$arity = 1);
      
      $writer = [["", "", true]];
      $send(Opal.const_set($nesting[0], 'QUOTE_TAGS', $hash2(["monospaced", "emphasis", "strong", "double", "single", "mark", "superscript", "subscript"], {"monospaced": ["<literal>", "</literal>", false], "emphasis": ["<emphasis>", "</emphasis>", true], "strong": ["<emphasis role=\"strong\">", "</emphasis>", true], "double": ["<quote>", "</quote>", true], "single": ["<quote>", "</quote>", true], "mark": ["<emphasis role=\"marked\">", "</emphasis>", false], "superscript": ["<superscript>", "</superscript>", false], "subscript": ["<subscript>", "</subscript>", false]})), 'default=', Opal.to_a($writer));
      $writer[$rb_minus($writer["length"], 1)];;
      
      Opal.def(self, '$inline_quoted', TMP_DocBook5Converter_inline_quoted_47 = function $$inline_quoted(node) {
        var $a, $b, $c, self = this, type = nil, equation = nil, open = nil, close = nil, supports_phrase = nil, text = nil, quoted_text = nil;

        if ((type = node.$type())['$==']("asciimath")) {
          if ((self.asciimath = ($truthy($a = self.asciimath) ? $a : (function() {if ($truthy(($truthy($b = (($c = $$$('::', 'AsciiMath', 'skip_raise')) ? 'constant' : nil)) ? $b : $$($nesting, 'Helpers').$require_library("asciimath", true, "warn"))['$nil?']())) {
            return "unavailable"
          } else {
            return "loaded"
          }; return nil; })()))['$==']("loaded")) {
            return "" + "<inlineequation>" + ($$$('::', 'AsciiMath').$parse(node.$text()).$to_mathml("mml:", $hash2(["xmlns:mml"], {"xmlns:mml": "http://www.w3.org/1998/Math/MathML"}))) + "</inlineequation>"
          } else {
            return "" + "<inlineequation><mathphrase><![CDATA[" + (node.$text()) + "]]></mathphrase></inlineequation>"
          }
        } else if (type['$==']("latexmath")) {
          return "" + "<inlineequation><alt><![CDATA[" + ((equation = node.$text())) + "]]></alt><mathphrase><![CDATA[" + (equation) + "]]></mathphrase></inlineequation>"
        } else {
          
          $b = $$($nesting, 'QUOTE_TAGS')['$[]'](type), $a = Opal.to_ary($b), (open = ($a[0] == null ? nil : $a[0])), (close = ($a[1] == null ? nil : $a[1])), (supports_phrase = ($a[2] == null ? nil : $a[2])), $b;
          text = node.$text();
          if ($truthy(node.$role())) {
            if ($truthy(supports_phrase)) {
              quoted_text = "" + (open) + "<phrase role=\"" + (node.$role()) + "\">" + (text) + "</phrase>" + (close)
            } else {
              quoted_text = "" + (open.$chop()) + " role=\"" + (node.$role()) + "\">" + (text) + (close)
            }
          } else {
            quoted_text = "" + (open) + (text) + (close)
          };
          if ($truthy(node.$id())) {
            return "" + "<anchor" + (self.$common_attributes(node.$id(), nil, text)) + "/>" + (quoted_text)
          } else {
            return quoted_text
          };
        }
      }, TMP_DocBook5Converter_inline_quoted_47.$$arity = 1);
      
      Opal.def(self, '$common_attributes', TMP_DocBook5Converter_common_attributes_48 = function $$common_attributes(id, role, reftext) {
        var $a, self = this, attrs = nil;

        if (role == null) {
          role = nil;
        }
        if (reftext == null) {
          reftext = nil;
        }
        
        attrs = (function() {if ($truthy(id)) {
          return "" + " xml:id=\"" + (id) + "\""
        } else {
          return ""
        }; return nil; })();
        if ($truthy(role)) {
          attrs = "" + (attrs) + " role=\"" + (role) + "\""};
        if ($truthy(reftext)) {
          
          if ($truthy(($truthy($a = reftext['$include?']("<")) ? (reftext = reftext.$gsub($$($nesting, 'XmlSanitizeRx'), ""))['$include?'](" ") : $a))) {
            reftext = reftext.$squeeze(" ").$strip()};
          if ($truthy(reftext['$include?']("\""))) {
            reftext = reftext.$gsub("\"", "&quot;")};
          attrs = "" + (attrs) + " xreflabel=\"" + (reftext) + "\"";};
        return attrs;
      }, TMP_DocBook5Converter_common_attributes_48.$$arity = -2);
      
      Opal.def(self, '$doctype_declaration', TMP_DocBook5Converter_doctype_declaration_49 = function $$doctype_declaration(root_tag_name) {
        var self = this;

        return nil
      }, TMP_DocBook5Converter_doctype_declaration_49.$$arity = 1);
      
      Opal.def(self, '$author_tag', TMP_DocBook5Converter_author_tag_50 = function $$author_tag(doc, index) {
        var self = this, firstname_key = nil, middlename_key = nil, lastname_key = nil, email_key = nil, result = nil;

        if (index == null) {
          index = nil;
        }
        
        firstname_key = (function() {if ($truthy(index)) {
          return "" + "firstname_" + (index)
        } else {
          return "firstname"
        }; return nil; })();
        middlename_key = (function() {if ($truthy(index)) {
          return "" + "middlename_" + (index)
        } else {
          return "middlename"
        }; return nil; })();
        lastname_key = (function() {if ($truthy(index)) {
          return "" + "lastname_" + (index)
        } else {
          return "lastname"
        }; return nil; })();
        email_key = (function() {if ($truthy(index)) {
          return "" + "email_" + (index)
        } else {
          return "email"
        }; return nil; })();
        result = [];
        result['$<<']("<author>");
        result['$<<']("<personname>");
        if ($truthy(doc['$attr?'](firstname_key))) {
          result['$<<']("" + "<firstname>" + (doc.$attr(firstname_key)) + "</firstname>")};
        if ($truthy(doc['$attr?'](middlename_key))) {
          result['$<<']("" + "<othername>" + (doc.$attr(middlename_key)) + "</othername>")};
        if ($truthy(doc['$attr?'](lastname_key))) {
          result['$<<']("" + "<surname>" + (doc.$attr(lastname_key)) + "</surname>")};
        result['$<<']("</personname>");
        if ($truthy(doc['$attr?'](email_key))) {
          result['$<<']("" + "<email>" + (doc.$attr(email_key)) + "</email>")};
        result['$<<']("</author>");
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_author_tag_50.$$arity = -2);
      
      Opal.def(self, '$document_info_tag', TMP_DocBook5Converter_document_info_tag_53 = function $$document_info_tag(doc, info_tag_prefix, use_info_tag_prefix) {
        var $a, TMP_51, $b, TMP_52, self = this, result = nil, date = nil, authorcount = nil, back_cover_tag = nil, front_cover_tag = nil, head_docinfo = nil;

        if (use_info_tag_prefix == null) {
          use_info_tag_prefix = false;
        }
        
        if ($truthy(use_info_tag_prefix)) {
        } else {
          info_tag_prefix = ""
        };
        result = [];
        result['$<<']("" + "<" + (info_tag_prefix) + "info>");
        if ($truthy(doc.$notitle())) {
        } else {
          result['$<<'](self.$document_title_tags(doc.$doctitle($hash2(["partition", "use_fallback"], {"partition": true, "use_fallback": true}))))
        };
        if ($truthy((date = (function() {if ($truthy(doc['$attr?']("revdate"))) {
          
          return doc.$attr("revdate");
        } else {
          
          if ($truthy(doc['$attr?']("reproducible"))) {
            return nil
          } else {
            
            return doc.$attr("docdate");
          };
        }; return nil; })()))) {
          result['$<<']("" + "<date>" + (date) + "</date>")};
        if ($truthy(doc['$attr?']("copyright"))) {
          
          $$($nesting, 'CopyrightRx')['$=~'](doc.$attr("copyright"));
          result['$<<']("<copyright>");
          result['$<<']("" + "<holder>" + ((($a = $gvars['~']) === nil ? nil : $a['$[]'](1))) + "</holder>");
          if ($truthy((($a = $gvars['~']) === nil ? nil : $a['$[]'](2)))) {
            result['$<<']("" + "<year>" + ((($a = $gvars['~']) === nil ? nil : $a['$[]'](2))) + "</year>")};
          result['$<<']("</copyright>");};
        if ($truthy(doc['$has_header?']())) {
          
          if ($truthy(doc['$attr?']("author"))) {
            if ($truthy($rb_lt((authorcount = doc.$attr("authorcount").$to_i()), 2))) {
              
              result['$<<'](self.$author_tag(doc));
              if ($truthy(doc['$attr?']("authorinitials"))) {
                result['$<<']("" + "<authorinitials>" + (doc.$attr("authorinitials")) + "</authorinitials>")};
            } else {
              
              result['$<<']("<authorgroup>");
              $send(authorcount, 'times', [], (TMP_51 = function(index){var self = TMP_51.$$s || this;
if (index == null) index = nil;
              return result['$<<'](self.$author_tag(doc, $rb_plus(index, 1)))}, TMP_51.$$s = self, TMP_51.$$arity = 1, TMP_51));
              result['$<<']("</authorgroup>");
            }};
          if ($truthy(($truthy($a = doc['$attr?']("revdate")) ? ($truthy($b = doc['$attr?']("revnumber")) ? $b : doc['$attr?']("revremark")) : $a))) {
            
            result['$<<']("" + "<revhistory>\n" + "<revision>");
            if ($truthy(doc['$attr?']("revnumber"))) {
              result['$<<']("" + "<revnumber>" + (doc.$attr("revnumber")) + "</revnumber>")};
            if ($truthy(doc['$attr?']("revdate"))) {
              result['$<<']("" + "<date>" + (doc.$attr("revdate")) + "</date>")};
            if ($truthy(doc['$attr?']("authorinitials"))) {
              result['$<<']("" + "<authorinitials>" + (doc.$attr("authorinitials")) + "</authorinitials>")};
            if ($truthy(doc['$attr?']("revremark"))) {
              result['$<<']("" + "<revremark>" + (doc.$attr("revremark")) + "</revremark>")};
            result['$<<']("" + "</revision>\n" + "</revhistory>");};
          if ($truthy(use_info_tag_prefix)) {
          } else if ($truthy(($truthy($a = doc['$attr?']("front-cover-image")) ? $a : doc['$attr?']("back-cover-image")))) {
            if ($truthy((back_cover_tag = self.$cover_tag(doc, "back")))) {
              
              result['$<<'](self.$cover_tag(doc, "front", true));
              result['$<<'](back_cover_tag);
            } else if ($truthy((front_cover_tag = self.$cover_tag(doc, "front")))) {
              result['$<<'](front_cover_tag)}};
          if ($truthy((head_docinfo = doc.$docinfo())['$empty?']())) {
          } else {
            result['$<<'](head_docinfo)
          };
          if ($truthy(doc['$attr?']("orgname"))) {
            result['$<<']("" + "<orgname>" + (doc.$attr("orgname")) + "</orgname>")};};
        result['$<<']("" + "</" + (info_tag_prefix) + "info>");
        if (doc.$doctype()['$==']("manpage")) {
          
          result['$<<']("<refmeta>");
          if ($truthy(doc['$attr?']("mantitle"))) {
            result['$<<']("" + "<refentrytitle>" + (doc.$attr("mantitle")) + "</refentrytitle>")};
          if ($truthy(doc['$attr?']("manvolnum"))) {
            result['$<<']("" + "<manvolnum>" + (doc.$attr("manvolnum")) + "</manvolnum>")};
          result['$<<']("" + "<refmiscinfo class=\"source\">" + (doc.$attr("mansource", "&#160;")) + "</refmiscinfo>");
          result['$<<']("" + "<refmiscinfo class=\"manual\">" + (doc.$attr("manmanual", "&#160;")) + "</refmiscinfo>");
          result['$<<']("</refmeta>");
          result['$<<']("<refnamediv>");
          if ($truthy(doc['$attr?']("mannames"))) {
            result = $rb_plus(result, $send(doc.$attr("mannames"), 'map', [], (TMP_52 = function(n){var self = TMP_52.$$s || this;
if (n == null) n = nil;
            return "" + "<refname>" + (n) + "</refname>"}, TMP_52.$$s = self, TMP_52.$$arity = 1, TMP_52)))};
          if ($truthy(doc['$attr?']("manpurpose"))) {
            result['$<<']("" + "<refpurpose>" + (doc.$attr("manpurpose")) + "</refpurpose>")};
          result['$<<']("</refnamediv>");};
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_document_info_tag_53.$$arity = -3);
      
      Opal.def(self, '$document_ns_attributes', TMP_DocBook5Converter_document_ns_attributes_54 = function $$document_ns_attributes(doc) {
        var self = this;

        return " xmlns=\"http://docbook.org/ns/docbook\" xmlns:xl=\"http://www.w3.org/1999/xlink\" version=\"5.0\""
      }, TMP_DocBook5Converter_document_ns_attributes_54.$$arity = 1);
      
      Opal.def(self, '$lang_attribute_name', TMP_DocBook5Converter_lang_attribute_name_55 = function $$lang_attribute_name() {
        var self = this;

        return "xml:lang"
      }, TMP_DocBook5Converter_lang_attribute_name_55.$$arity = 0);
      
      Opal.def(self, '$document_title_tags', TMP_DocBook5Converter_document_title_tags_56 = function $$document_title_tags(title) {
        var self = this;

        if ($truthy(title['$subtitle?']())) {
          return "" + "<title>" + (title.$main()) + "</title>\n" + "<subtitle>" + (title.$subtitle()) + "</subtitle>"
        } else {
          return "" + "<title>" + (title) + "</title>"
        }
      }, TMP_DocBook5Converter_document_title_tags_56.$$arity = 1);
      
      Opal.def(self, '$resolve_content', TMP_DocBook5Converter_resolve_content_57 = function $$resolve_content(node) {
        var self = this;

        if (node.$content_model()['$==']("compound")) {
          return node.$content()
        } else {
          return "" + "<simpara>" + (node.$content()) + "</simpara>"
        }
      }, TMP_DocBook5Converter_resolve_content_57.$$arity = 1);
      
      Opal.def(self, '$title_tag', TMP_DocBook5Converter_title_tag_58 = function $$title_tag(node, optional) {
        var $a, self = this;

        if (optional == null) {
          optional = true;
        }
        if ($truthy(($truthy($a = optional['$!']()) ? $a : node['$title?']()))) {
          return "" + "<title>" + (node.$title()) + "</title>\n"
        } else {
          return ""
        }
      }, TMP_DocBook5Converter_title_tag_58.$$arity = -2);
      
      Opal.def(self, '$cover_tag', TMP_DocBook5Converter_cover_tag_59 = function $$cover_tag(doc, face, use_placeholder) {
        var $a, self = this, cover_image = nil, width_attr = nil, depth_attr = nil, attrs = nil;

        if (use_placeholder == null) {
          use_placeholder = false;
        }
        if ($truthy((cover_image = doc.$attr("" + (face) + "-cover-image")))) {
          
          width_attr = "";
          depth_attr = "";
          if ($truthy(($truthy($a = cover_image['$include?'](":")) ? $$($nesting, 'ImageMacroRx')['$=~'](cover_image) : $a))) {
            
            cover_image = doc.$image_uri((($a = $gvars['~']) === nil ? nil : $a['$[]'](1)));
            if ($truthy((($a = $gvars['~']) === nil ? nil : $a['$[]'](2))['$empty?']())) {
            } else {
              
              attrs = $$($nesting, 'AttributeList').$new((($a = $gvars['~']) === nil ? nil : $a['$[]'](2))).$parse(["alt", "width", "height"]);
              if ($truthy(attrs['$key?']("scaledwidth"))) {
                width_attr = "" + " width=\"" + (attrs['$[]']("scaledwidth")) + "\""
              } else {
                
                if ($truthy(attrs['$key?']("width"))) {
                  width_attr = "" + " contentwidth=\"" + (attrs['$[]']("width")) + "\""};
                if ($truthy(attrs['$key?']("height"))) {
                  depth_attr = "" + " contentdepth=\"" + (attrs['$[]']("height")) + "\""};
              };
            };};
          return "" + "<cover role=\"" + (face) + "\">\n" + "<mediaobject>\n" + "<imageobject>\n" + "<imagedata fileref=\"" + (cover_image) + "\"" + (width_attr) + (depth_attr) + "/>\n" + "</imageobject>\n" + "</mediaobject>\n" + "</cover>";
        } else if ($truthy(use_placeholder)) {
          return "" + "<cover role=\"" + (face) + "\"/>"
        } else {
          return nil
        }
      }, TMP_DocBook5Converter_cover_tag_59.$$arity = -3);
      return (Opal.def(self, '$blockquote_tag', TMP_DocBook5Converter_blockquote_tag_60 = function $$blockquote_tag(node, tag_name) {
        var $a, self = this, $iter = TMP_DocBook5Converter_blockquote_tag_60.$$p, $yield = $iter || nil, start_tag = nil, end_tag = nil, result = nil;

        if (tag_name == null) {
          tag_name = nil;
        }
        if ($iter) TMP_DocBook5Converter_blockquote_tag_60.$$p = null;
        
        if ($truthy(tag_name)) {
          $a = ["" + "<" + (tag_name), "" + "</" + (tag_name) + ">"], (start_tag = $a[0]), (end_tag = $a[1]), $a
        } else {
          $a = ["<blockquote", "</blockquote>"], (start_tag = $a[0]), (end_tag = $a[1]), $a
        };
        result = ["" + (start_tag) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">"];
        if ($truthy(node['$title?']())) {
          result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
        if ($truthy(($truthy($a = node['$attr?']("attribution")) ? $a : node['$attr?']("citetitle")))) {
          
          result['$<<']("<attribution>");
          if ($truthy(node['$attr?']("attribution"))) {
            result['$<<'](node.$attr("attribution"))};
          if ($truthy(node['$attr?']("citetitle"))) {
            result['$<<']("" + "<citetitle>" + (node.$attr("citetitle")) + "</citetitle>")};
          result['$<<']("</attribution>");};
        result['$<<'](Opal.yieldX($yield, []));
        result['$<<'](end_tag);
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_blockquote_tag_60.$$arity = -2), nil) && 'blockquote_tag';
    })($$($nesting, 'Converter'), $$$($$($nesting, 'Converter'), 'BuiltIn'), $nesting)
  })($nesting[0], $nesting)
};

/* Generated by Opal 0.11.1.dev */
(function(Opal) {
  function $rb_times(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs * rhs : lhs['$*'](rhs);
  }
  var self = Opal.top, $nesting = [], nil = Opal.nil, $$$ = Opal.const_get_qualified, $$ = Opal.const_get_relative, $breaker = Opal.breaker, $slice = Opal.slice, $module = Opal.module, $klass = Opal.klass, $send = Opal.send, $truthy = Opal.truthy;

  Opal.add_stubs(['$require', '$==', '$context', '$parent', '$style', '$attr?', '$attr', '$<<', '$common_attributes', '$id', '$role', '$reftext', '$title?', '$title', '$each_with_index', '$items', '$text', '$blocks?', '$content', '$*', '$type', '$===', '$target', '$[]', '$attributes', '$empty?']);
  
  self.$require("asciidoctor/converter/docbook5");
  return (function($base, $parent_nesting) {
    function $Asciidoctor() {};
    var self = $Asciidoctor = $module($base, 'Asciidoctor', $Asciidoctor);

    var def = self.prototype, $nesting = [self].concat($parent_nesting);

    (function($base, $super, $parent_nesting) {
      function $DocBook45Converter(){};
      var self = $DocBook45Converter = $klass($base, $super, 'DocBook45Converter', $DocBook45Converter);

      var def = self.prototype, $nesting = [self].concat($parent_nesting), TMP_DocBook45Converter_admonition_1, TMP_DocBook45Converter_olist_3, TMP_DocBook45Converter_inline_anchor_4, TMP_DocBook45Converter_author_tag_5, TMP_DocBook45Converter_common_attributes_6, TMP_DocBook45Converter_doctype_declaration_7, TMP_DocBook45Converter_document_info_tag_8, TMP_DocBook45Converter_lang_attribute_name_9, TMP_DocBook45Converter_document_ns_attributes_10;

      
      
      Opal.def(self, '$admonition', TMP_DocBook45Converter_admonition_1 = function $$admonition(node) {
        var self = this, $iter = TMP_DocBook45Converter_admonition_1.$$p, $yield = $iter || nil, $zuper = nil, $zuper_i = nil, $zuper_ii = nil;

        if ($iter) TMP_DocBook45Converter_admonition_1.$$p = null;
        // Prepare super implicit arguments
        for($zuper_i = 0, $zuper_ii = arguments.length, $zuper = new Array($zuper_ii); $zuper_i < $zuper_ii; $zuper_i++) {
          $zuper[$zuper_i] = arguments[$zuper_i];
        }
        if (node.$parent().$context()['$==']("example")) {
          return "" + "<para>\n" + ($send(self, Opal.find_super_dispatcher(self, 'admonition', TMP_DocBook45Converter_admonition_1, false), $zuper, $iter)) + "\n" + "</para>"
        } else {
          return $send(self, Opal.find_super_dispatcher(self, 'admonition', TMP_DocBook45Converter_admonition_1, false), $zuper, $iter)
        }
      }, TMP_DocBook45Converter_admonition_1.$$arity = 1);
      
      Opal.def(self, '$olist', TMP_DocBook45Converter_olist_3 = function $$olist(node) {
        var TMP_2, self = this, result = nil, num_attribute = nil, start_attribute = nil;

        
        result = [];
        num_attribute = (function() {if ($truthy(node.$style())) {
          return "" + " numeration=\"" + (node.$style()) + "\""
        } else {
          return ""
        }; return nil; })();
        start_attribute = (function() {if ($truthy(node['$attr?']("start"))) {
          return "" + " override=\"" + (node.$attr("start")) + "\""
        } else {
          return ""
        }; return nil; })();
        result['$<<']("" + "<orderedlist" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + (num_attribute) + ">");
        if ($truthy(node['$title?']())) {
          result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
        $send(node.$items(), 'each_with_index', [], (TMP_2 = function(item, idx){var self = TMP_2.$$s || this;
if (item == null) item = nil;if (idx == null) idx = nil;
        
          result['$<<']((function() {if (idx['$=='](0)) {
            return "" + "<listitem" + (start_attribute) + ">"
          } else {
            return "<listitem>"
          }; return nil; })());
          result['$<<']("" + "<simpara>" + (item.$text()) + "</simpara>");
          if ($truthy(item['$blocks?']())) {
            result['$<<'](item.$content())};
          return result['$<<']("</listitem>");}, TMP_2.$$s = self, TMP_2.$$arity = 2, TMP_2));
        result['$<<']("</orderedlist>");
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook45Converter_olist_3.$$arity = 1);
      
      Opal.def(self, '$inline_anchor', TMP_DocBook45Converter_inline_anchor_4 = function $$inline_anchor(node) {
        var $a, self = this, $case = nil, path = nil, linkend = nil, text = nil, target = nil;

        return (function() {$case = node.$type();
        if ("ref"['$===']($case)) {return "" + "<anchor" + (self.$common_attributes(node.$target(), nil, node.$text())) + "/>"}
        else if ("xref"['$===']($case)) {if ($truthy((path = node.$attributes()['$[]']("path")))) {
          return "" + "<ulink url=\"" + (node.$target()) + "\">" + (($truthy($a = node.$text()) ? $a : path)) + "</ulink>"
        } else {
          
          linkend = ($truthy($a = node.$attributes()['$[]']("fragment")) ? $a : node.$target());
          if ($truthy((text = node.$text()))) {
            return "" + "<link linkend=\"" + (linkend) + "\">" + (text) + "</link>"
          } else {
            return "" + "<xref linkend=\"" + (linkend) + "\"/>"
          };
        }}
        else if ("link"['$===']($case)) {return "" + "<ulink url=\"" + (node.$target()) + "\">" + (node.$text()) + "</ulink>"}
        else if ("bibref"['$===']($case)) {
        target = node.$target();
        return "" + "<anchor" + (self.$common_attributes(target, nil, "" + "[" + (target) + "]")) + "/>[" + (target) + "]";}
        else { return nil }})()
      }, TMP_DocBook45Converter_inline_anchor_4.$$arity = 1);
      
      Opal.def(self, '$author_tag', TMP_DocBook45Converter_author_tag_5 = function $$author_tag(doc, index) {
        var self = this, firstname_key = nil, middlename_key = nil, lastname_key = nil, email_key = nil, result = nil;

        if (index == null) {
          index = nil;
        }
        
        if ($truthy(index)) {
          
          firstname_key = "" + "firstname_" + (index);
          middlename_key = "" + "middlename_" + (index);
          lastname_key = "" + "lastname_" + (index);
          email_key = "" + "email_" + (index);
        } else {
          
          firstname_key = "firstname";
          middlename_key = "middlename";
          lastname_key = "lastname";
          email_key = "email";
        };
        result = [];
        result['$<<']("<author>");
        if ($truthy(doc['$attr?'](firstname_key))) {
          result['$<<']("" + "<firstname>" + (doc.$attr(firstname_key)) + "</firstname>")};
        if ($truthy(doc['$attr?'](middlename_key))) {
          result['$<<']("" + "<othername>" + (doc.$attr(middlename_key)) + "</othername>")};
        if ($truthy(doc['$attr?'](lastname_key))) {
          result['$<<']("" + "<surname>" + (doc.$attr(lastname_key)) + "</surname>")};
        if ($truthy(doc['$attr?'](email_key))) {
          result['$<<']("" + "<email>" + (doc.$attr(email_key)) + "</email>")};
        result['$<<']("</author>");
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook45Converter_author_tag_5.$$arity = -2);
      
      Opal.def(self, '$common_attributes', TMP_DocBook45Converter_common_attributes_6 = function $$common_attributes(id, role, reftext) {
        var self = this, res = nil;

        if (role == null) {
          role = nil;
        }
        if (reftext == null) {
          reftext = nil;
        }
        
        res = (function() {if ($truthy(id)) {
          return "" + " id=\"" + (id) + "\""
        } else {
          return ""
        }; return nil; })();
        if ($truthy(role)) {
          res = "" + (res) + " role=\"" + (role) + "\""};
        if ($truthy(reftext)) {
          res = "" + (res) + " xreflabel=\"" + (reftext) + "\""};
        return res;
      }, TMP_DocBook45Converter_common_attributes_6.$$arity = -2);
      
      Opal.def(self, '$doctype_declaration', TMP_DocBook45Converter_doctype_declaration_7 = function $$doctype_declaration(root_tag_name) {
        var self = this;

        return "" + "<!DOCTYPE " + (root_tag_name) + " PUBLIC \"-//OASIS//DTD DocBook XML V4.5//EN\" \"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd\">"
      }, TMP_DocBook45Converter_doctype_declaration_7.$$arity = 1);
      
      Opal.def(self, '$document_info_tag', TMP_DocBook45Converter_document_info_tag_8 = function $$document_info_tag(doc, info_tag_prefix) {
        var self = this, $iter = TMP_DocBook45Converter_document_info_tag_8.$$p, $yield = $iter || nil;

        if ($iter) TMP_DocBook45Converter_document_info_tag_8.$$p = null;
        return $send(self, Opal.find_super_dispatcher(self, 'document_info_tag', TMP_DocBook45Converter_document_info_tag_8, false), [doc, info_tag_prefix, true], null)
      }, TMP_DocBook45Converter_document_info_tag_8.$$arity = 2);
      
      Opal.def(self, '$lang_attribute_name', TMP_DocBook45Converter_lang_attribute_name_9 = function $$lang_attribute_name() {
        var self = this;

        return "lang"
      }, TMP_DocBook45Converter_lang_attribute_name_9.$$arity = 0);
      return (Opal.def(self, '$document_ns_attributes', TMP_DocBook45Converter_document_ns_attributes_10 = function $$document_ns_attributes(doc) {
        var self = this, ns = nil;

        if ($truthy((ns = doc.$attr("xmlns")))) {
          if ($truthy(ns['$empty?']())) {
            return " xmlns=\"http://docbook.org/ns/docbook\""
          } else {
            return "" + " xmlns=\"" + (ns) + "\""
          }
        } else {
          return ""
        }
      }, TMP_DocBook45Converter_document_ns_attributes_10.$$arity = 1), nil) && 'document_ns_attributes';
    })($$($nesting, 'Converter'), $$$($$($nesting, 'Converter'), 'DocBook5Converter'), $nesting)
  })($nesting[0], $nesting);
})(Opal);

/* Generated by Opal 0.11.1.dev */
(function(Opal) {
  function $rb_times(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs * rhs : lhs['$*'](rhs);
  }
  function $rb_minus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs - rhs : lhs['$-'](rhs);
  }
  function $rb_gt(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs > rhs : lhs['$>'](rhs);
  }
  function $rb_plus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs + rhs : lhs['$+'](rhs);
  }
  function $rb_lt(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs < rhs : lhs['$<'](rhs);
  }
  var self = Opal.top, $nesting = [], nil = Opal.nil, $$$ = Opal.const_get_qualified, $$ = Opal.const_get_relative, $breaker = Opal.breaker, $slice = Opal.slice, $module = Opal.module, $klass = Opal.klass, $truthy = Opal.truthy, $hash2 = Opal.hash2, $send = Opal.send, $gvars = Opal.gvars;

  Opal.add_stubs(['$==', '$doctype', '$<<', '$doctype_declaration', '$attr?', '$attr', '$lang_attribute_name', '$document_ns_attributes', '$noheader', '$document_info_tag', '$blocks?', '$content', '$empty?', '$docinfo', '$*', '$document', '$[]', '$sectname', '$special', '$option?', '$title', '$common_attributes', '$id', '$role', '$reftext', '$title_tag', '$resolve_content', '$title?', '$each', '$items', '$text', '$default=', '$-', '$style', '$text?', '$level', '$image_uri', '$alt', '$!', '$index', '$subs', '$delete_at', '$>', '$insert', '$unshift', '$nil?', '$require_library', '$to_mathml', '$parse', '$===', '$parent', '$warn', '$logger', '$context', '$error', '$content_model', '$blockquote_tag', '$has_role?', '$include?', '$columns', '$by_section', '$rows', '$colspan', '$column', '$+', '$rowspan', '$type', '$attributes', '$target', '$inspect', '$icon_uri', '$size', '$chop', '$gsub', '$strip', '$squeeze', '$notitle', '$document_title_tags', '$doctitle', '$=~', '$has_header?', '$<', '$to_i', '$author_tag', '$times', '$cover_tag', '$map', '$subtitle?', '$main', '$subtitle', '$new', '$key?']);
  return (function($base, $parent_nesting) {
    function $Asciidoctor() {};
    var self = $Asciidoctor = $module($base, 'Asciidoctor', $Asciidoctor);

    var def = self.prototype, $nesting = [self].concat($parent_nesting);

    (function($base, $super, $parent_nesting) {
      function $DocBook5Converter(){};
      var self = $DocBook5Converter = $klass($base, $super, 'DocBook5Converter', $DocBook5Converter);

      var def = self.prototype, $nesting = [self].concat($parent_nesting), TMP_DocBook5Converter_document_1, TMP_DocBook5Converter_section_2, TMP_DocBook5Converter_admonition_3, TMP_DocBook5Converter_colist_5, TMP_DocBook5Converter_dlist_10, TMP_DocBook5Converter_example_11, TMP_DocBook5Converter_floating_title_12, TMP_DocBook5Converter_image_13, TMP_DocBook5Converter_listing_14, TMP_DocBook5Converter_literal_15, TMP_DocBook5Converter_stem_16, TMP_DocBook5Converter_olist_18, TMP_DocBook5Converter_open_19, TMP_DocBook5Converter_page_break_20, TMP_DocBook5Converter_paragraph_21, TMP_DocBook5Converter_preamble_22, TMP_DocBook5Converter_quote_24, TMP_DocBook5Converter_thematic_break_25, TMP_DocBook5Converter_sidebar_26, TMP_DocBook5Converter_table_32, TMP_DocBook5Converter_ulist_35, TMP_DocBook5Converter_verse_37, TMP_DocBook5Converter_inline_anchor_38, TMP_DocBook5Converter_inline_break_39, TMP_DocBook5Converter_inline_button_40, TMP_DocBook5Converter_inline_callout_41, TMP_DocBook5Converter_inline_footnote_42, TMP_DocBook5Converter_inline_image_43, TMP_DocBook5Converter_inline_indexterm_44, TMP_DocBook5Converter_inline_kbd_45, TMP_DocBook5Converter_inline_menu_46, TMP_DocBook5Converter_inline_quoted_47, TMP_DocBook5Converter_common_attributes_48, TMP_DocBook5Converter_doctype_declaration_49, TMP_DocBook5Converter_author_tag_50, TMP_DocBook5Converter_document_info_tag_53, TMP_DocBook5Converter_document_ns_attributes_54, TMP_DocBook5Converter_lang_attribute_name_55, TMP_DocBook5Converter_document_title_tags_56, TMP_DocBook5Converter_resolve_content_57, TMP_DocBook5Converter_title_tag_58, TMP_DocBook5Converter_cover_tag_59, TMP_DocBook5Converter_blockquote_tag_60, $writer = nil;

      def.asciimath = nil;
      
      Opal.const_set($nesting[0], 'CopyrightRx', /^(.+?)(?: ((?:\d{4}\-)?\d{4}))?$/);
      Opal.const_set($nesting[0], 'ImageMacroRx', /^image::?(.+?)\[(.*?)\]$/);
      
      Opal.def(self, '$document', TMP_DocBook5Converter_document_1 = function $$document(node) {
        var self = this, result = nil, root_tag_name = nil, doctype_line = nil, lang_attribute = nil, footer_docinfo = nil;

        
        result = [];
        if ((root_tag_name = node.$doctype())['$==']("manpage")) {
          root_tag_name = "refentry"};
        result['$<<']("<?xml version=\"1.0\" encoding=\"UTF-8\"?>");
        if ($truthy((doctype_line = self.$doctype_declaration(root_tag_name)))) {
          result['$<<'](doctype_line)};
        if ($truthy(node['$attr?']("toc"))) {
          if ($truthy(node['$attr?']("toclevels"))) {
            result['$<<']("" + "<?asciidoc-toc maxdepth=\"" + (node.$attr("toclevels")) + "\"?>")
          } else {
            result['$<<']("<?asciidoc-toc?>")
          }};
        if ($truthy(node['$attr?']("sectnums"))) {
          if ($truthy(node['$attr?']("sectnumlevels"))) {
            result['$<<']("" + "<?asciidoc-numbered maxdepth=\"" + (node.$attr("sectnumlevels")) + "\"?>")
          } else {
            result['$<<']("<?asciidoc-numbered?>")
          }};
        lang_attribute = (function() {if ($truthy(node['$attr?']("nolang"))) {
          return ""
        } else {
          return "" + " " + (self.$lang_attribute_name()) + "=\"" + (node.$attr("lang", "en")) + "\""
        }; return nil; })();
        result['$<<']("" + "<" + (root_tag_name) + (self.$document_ns_attributes(node)) + (lang_attribute) + ">");
        if ($truthy(node.$noheader())) {
        } else {
          result['$<<'](self.$document_info_tag(node, root_tag_name))
        };
        if ($truthy(node['$blocks?']())) {
          result['$<<'](node.$content())};
        if ($truthy((footer_docinfo = node.$docinfo("footer"))['$empty?']())) {
        } else {
          result['$<<'](footer_docinfo)
        };
        result['$<<']("" + "</" + (root_tag_name) + ">");
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_document_1.$$arity = 1);
      Opal.alias(self, "embedded", "content");
      Opal.const_set($nesting[0], 'MANPAGE_SECTION_TAGS', $hash2(["section", "synopsis"], {"section": "refsection", "synopsis": "refsynopsisdiv"}));
      
      Opal.def(self, '$section', TMP_DocBook5Converter_section_2 = function $$section(node) {
        var $a, self = this, tag_name = nil, title_el = nil;

        
        if (node.$document().$doctype()['$==']("manpage")) {
          tag_name = ($truthy($a = $$($nesting, 'MANPAGE_SECTION_TAGS')['$[]']((tag_name = node.$sectname()))) ? $a : tag_name)
        } else {
          tag_name = node.$sectname()
        };
        title_el = (function() {if ($truthy(($truthy($a = node.$special()) ? node['$option?']("untitled") : $a))) {
          return ""
        } else {
          return "" + "<title>" + (node.$title()) + "</title>\n"
        }; return nil; })();
        return "" + "<" + (tag_name) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (title_el) + (node.$content()) + "\n" + "</" + (tag_name) + ">";
      }, TMP_DocBook5Converter_section_2.$$arity = 1);
      
      Opal.def(self, '$admonition', TMP_DocBook5Converter_admonition_3 = function $$admonition(node) {
        var self = this, tag_name = nil;

        return "" + "<" + ((tag_name = node.$attr("name"))) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$title_tag(node)) + (self.$resolve_content(node)) + "\n" + "</" + (tag_name) + ">"
      }, TMP_DocBook5Converter_admonition_3.$$arity = 1);
      Opal.alias(self, "audio", "skip");
      
      Opal.def(self, '$colist', TMP_DocBook5Converter_colist_5 = function $$colist(node) {
        var TMP_4, self = this, result = nil;

        
        result = [];
        result['$<<']("" + "<calloutlist" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">");
        if ($truthy(node['$title?']())) {
          result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
        $send(node.$items(), 'each', [], (TMP_4 = function(item){var self = TMP_4.$$s || this;
if (item == null) item = nil;
        
          result['$<<']("" + "<callout arearefs=\"" + (item.$attr("coids")) + "\">");
          result['$<<']("" + "<para>" + (item.$text()) + "</para>");
          if ($truthy(item['$blocks?']())) {
            result['$<<'](item.$content())};
          return result['$<<']("</callout>");}, TMP_4.$$s = self, TMP_4.$$arity = 1, TMP_4));
        result['$<<']("</calloutlist>");
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_colist_5.$$arity = 1);
      
      $writer = [$hash2(["list", "entry", "term", "item"], {"list": "variablelist", "entry": "varlistentry", "term": "term", "item": "listitem"})];
      $send(Opal.const_set($nesting[0], 'DLIST_TAGS', $hash2(["qanda", "glossary"], {"qanda": $hash2(["list", "entry", "label", "term", "item"], {"list": "qandaset", "entry": "qandaentry", "label": "question", "term": "simpara", "item": "answer"}), "glossary": $hash2(["list", "entry", "term", "item"], {"list": nil, "entry": "glossentry", "term": "glossterm", "item": "glossdef"})})), 'default=', Opal.to_a($writer));
      $writer[$rb_minus($writer["length"], 1)];;
      
      Opal.def(self, '$dlist', TMP_DocBook5Converter_dlist_10 = function $$dlist(node) {
        var TMP_6, TMP_8, self = this, result = nil, tag_name = nil, tags = nil, list_tag = nil, entry_tag = nil, label_tag = nil, term_tag = nil, item_tag = nil;

        
        result = [];
        if (node.$style()['$==']("horizontal")) {
          
          result['$<<']("" + "<" + ((tag_name = (function() {if ($truthy(node['$title?']())) {
            return "table"
          } else {
            return "informaltable"
          }; return nil; })())) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + " tabstyle=\"horizontal\" frame=\"none\" colsep=\"0\" rowsep=\"0\">\n" + (self.$title_tag(node)) + "<tgroup cols=\"2\">\n" + "<colspec colwidth=\"" + (node.$attr("labelwidth", 15)) + "*\"/>\n" + "<colspec colwidth=\"" + (node.$attr("itemwidth", 85)) + "*\"/>\n" + "<tbody valign=\"top\">");
          $send(node.$items(), 'each', [], (TMP_6 = function(terms, dd){var self = TMP_6.$$s || this, TMP_7;
if (terms == null) terms = nil;if (dd == null) dd = nil;
          
            result['$<<']("" + "<row>\n" + "<entry>");
            $send([].concat(Opal.to_a(terms)), 'each', [], (TMP_7 = function(dt){var self = TMP_7.$$s || this;
if (dt == null) dt = nil;
            return result['$<<']("" + "<simpara>" + (dt.$text()) + "</simpara>")}, TMP_7.$$s = self, TMP_7.$$arity = 1, TMP_7));
            result['$<<']("" + "</entry>\n" + "<entry>");
            if ($truthy(dd)) {
              
              if ($truthy(dd['$text?']())) {
                result['$<<']("" + "<simpara>" + (dd.$text()) + "</simpara>")};
              if ($truthy(dd['$blocks?']())) {
                result['$<<'](dd.$content())};};
            return result['$<<']("" + "</entry>\n" + "</row>");}, TMP_6.$$s = self, TMP_6.$$arity = 2, TMP_6));
          result['$<<']("" + "</tbody>\n" + "</tgroup>\n" + "</" + (tag_name) + ">");
        } else {
          
          tags = $$($nesting, 'DLIST_TAGS')['$[]'](node.$style());
          list_tag = tags['$[]']("list");
          entry_tag = tags['$[]']("entry");
          label_tag = tags['$[]']("label");
          term_tag = tags['$[]']("term");
          item_tag = tags['$[]']("item");
          if ($truthy(list_tag)) {
            
            result['$<<']("" + "<" + (list_tag) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">");
            if ($truthy(node['$title?']())) {
              result['$<<']("" + "<title>" + (node.$title()) + "</title>")};};
          $send(node.$items(), 'each', [], (TMP_8 = function(terms, dd){var self = TMP_8.$$s || this, TMP_9;
if (terms == null) terms = nil;if (dd == null) dd = nil;
          
            result['$<<']("" + "<" + (entry_tag) + ">");
            if ($truthy(label_tag)) {
              result['$<<']("" + "<" + (label_tag) + ">")};
            $send([].concat(Opal.to_a(terms)), 'each', [], (TMP_9 = function(dt){var self = TMP_9.$$s || this;
if (dt == null) dt = nil;
            return result['$<<']("" + "<" + (term_tag) + ">" + (dt.$text()) + "</" + (term_tag) + ">")}, TMP_9.$$s = self, TMP_9.$$arity = 1, TMP_9));
            if ($truthy(label_tag)) {
              result['$<<']("" + "</" + (label_tag) + ">")};
            result['$<<']("" + "<" + (item_tag) + ">");
            if ($truthy(dd)) {
              
              if ($truthy(dd['$text?']())) {
                result['$<<']("" + "<simpara>" + (dd.$text()) + "</simpara>")};
              if ($truthy(dd['$blocks?']())) {
                result['$<<'](dd.$content())};};
            result['$<<']("" + "</" + (item_tag) + ">");
            return result['$<<']("" + "</" + (entry_tag) + ">");}, TMP_8.$$s = self, TMP_8.$$arity = 2, TMP_8));
          if ($truthy(list_tag)) {
            result['$<<']("" + "</" + (list_tag) + ">")};
        };
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_dlist_10.$$arity = 1);
      
      Opal.def(self, '$example', TMP_DocBook5Converter_example_11 = function $$example(node) {
        var self = this;

        if ($truthy(node['$title?']())) {
          return "" + "<example" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + (self.$resolve_content(node)) + "\n" + "</example>"
        } else {
          return "" + "<informalexample" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$resolve_content(node)) + "\n" + "</informalexample>"
        }
      }, TMP_DocBook5Converter_example_11.$$arity = 1);
      
      Opal.def(self, '$floating_title', TMP_DocBook5Converter_floating_title_12 = function $$floating_title(node) {
        var self = this;

        return "" + "<bridgehead" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + " renderas=\"sect" + (node.$level()) + "\">" + (node.$title()) + "</bridgehead>"
      }, TMP_DocBook5Converter_floating_title_12.$$arity = 1);
      
      Opal.def(self, '$image', TMP_DocBook5Converter_image_13 = function $$image(node) {
        var self = this, width_attribute = nil, depth_attribute = nil, scale_attribute = nil, align_attribute = nil, mediaobject = nil;

        
        if ($truthy(node['$attr?']("scaledwidth"))) {
          
          width_attribute = "" + " width=\"" + (node.$attr("scaledwidth")) + "\"";
          depth_attribute = "";
          scale_attribute = "";
        } else if ($truthy(node['$attr?']("scale"))) {
          scale_attribute = "" + " scale=\"" + (node.$attr("scale")) + "\""
        } else {
          
          width_attribute = (function() {if ($truthy(node['$attr?']("width"))) {
            return "" + " contentwidth=\"" + (node.$attr("width")) + "\""
          } else {
            return ""
          }; return nil; })();
          depth_attribute = (function() {if ($truthy(node['$attr?']("height"))) {
            return "" + " contentdepth=\"" + (node.$attr("height")) + "\""
          } else {
            return ""
          }; return nil; })();
          scale_attribute = "";
        };
        align_attribute = (function() {if ($truthy(node['$attr?']("align"))) {
          return "" + " align=\"" + (node.$attr("align")) + "\""
        } else {
          return ""
        }; return nil; })();
        mediaobject = "" + "<mediaobject>\n" + "<imageobject>\n" + "<imagedata fileref=\"" + (node.$image_uri(node.$attr("target"))) + "\"" + (width_attribute) + (depth_attribute) + (scale_attribute) + (align_attribute) + "/>\n" + "</imageobject>\n" + "<textobject><phrase>" + (node.$alt()) + "</phrase></textobject>\n" + "</mediaobject>";
        if ($truthy(node['$title?']())) {
          return "" + "<figure" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + (mediaobject) + "\n" + "</figure>"
        } else {
          return "" + "<informalfigure" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (mediaobject) + "\n" + "</informalfigure>"
        };
      }, TMP_DocBook5Converter_image_13.$$arity = 1);
      
      Opal.def(self, '$listing', TMP_DocBook5Converter_listing_14 = function $$listing(node) {
        var $a, self = this, informal = nil, listing_attributes = nil, numbering = nil, listing_content = nil;

        
        informal = node['$title?']()['$!']();
        listing_attributes = self.$common_attributes(node.$id(), node.$role(), node.$reftext());
        if ($truthy((($a = node.$style()['$==']("source")) ? node['$attr?']("language") : node.$style()['$==']("source")))) {
          
          numbering = (function() {if ($truthy(node['$attr?']("linenums", nil, false))) {
            return "numbered"
          } else {
            return "unnumbered"
          }; return nil; })();
          listing_content = "" + "<programlisting" + ((function() {if ($truthy(informal)) {
            return listing_attributes
          } else {
            return ""
          }; return nil; })()) + " language=\"" + (node.$attr("language", "", false)) + "\" linenumbering=\"" + (numbering) + "\">" + (node.$content()) + "</programlisting>";
        } else {
          listing_content = "" + "<screen" + ((function() {if ($truthy(informal)) {
            return listing_attributes
          } else {
            return ""
          }; return nil; })()) + ">" + (node.$content()) + "</screen>"
        };
        if ($truthy(informal)) {
          return listing_content
        } else {
          return "" + "<formalpara" + (listing_attributes) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + "<para>\n" + (listing_content) + "\n" + "</para>\n" + "</formalpara>"
        };
      }, TMP_DocBook5Converter_listing_14.$$arity = 1);
      
      Opal.def(self, '$literal', TMP_DocBook5Converter_literal_15 = function $$literal(node) {
        var self = this;

        if ($truthy(node['$title?']())) {
          return "" + "<formalpara" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + "<para>\n" + "<literallayout class=\"monospaced\">" + (node.$content()) + "</literallayout>\n" + "</para>\n" + "</formalpara>"
        } else {
          return "" + "<literallayout" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + " class=\"monospaced\">" + (node.$content()) + "</literallayout>"
        }
      }, TMP_DocBook5Converter_literal_15.$$arity = 1);
      
      Opal.def(self, '$stem', TMP_DocBook5Converter_stem_16 = function $$stem(node) {
        var $a, $b, $c, self = this, idx = nil, equation = nil, equation_data = nil;

        
        if ($truthy((idx = node.$subs().$index("specialcharacters")))) {
          
          node.$subs().$delete_at(idx);
          equation = node.$content();
          if ($truthy($rb_gt(idx, 0))) {
            
            node.$subs().$insert(idx, "specialcharacters");
          } else {
            
            node.$subs().$unshift("specialcharacters");
          };
        } else {
          equation = node.$content()
        };
        if (node.$style()['$==']("asciimath")) {
          if ((self.asciimath = ($truthy($a = self.asciimath) ? $a : (function() {if ($truthy(($truthy($b = (($c = $$$('::', 'AsciiMath', 'skip_raise')) ? 'constant' : nil)) ? $b : $$($nesting, 'Helpers').$require_library("asciimath", true, "warn"))['$nil?']())) {
            return "unavailable"
          } else {
            return "loaded"
          }; return nil; })()))['$==']("loaded")) {
            equation_data = $$$('::', 'AsciiMath').$parse(equation).$to_mathml("mml:", $hash2(["xmlns:mml"], {"xmlns:mml": "http://www.w3.org/1998/Math/MathML"}))
          } else {
            equation_data = "" + "<mathphrase><![CDATA[" + (equation) + "]]></mathphrase>"
          }
        } else {
          equation_data = "" + "<alt><![CDATA[" + (equation) + "]]></alt>\n" + "<mathphrase><![CDATA[" + (equation) + "]]></mathphrase>"
        };
        if ($truthy(node['$title?']())) {
          return "" + "<equation" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + (equation_data) + "\n" + "</equation>"
        } else {
          return "" + "<informalequation" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (equation_data) + "\n" + "</informalequation>"
        };
      }, TMP_DocBook5Converter_stem_16.$$arity = 1);
      
      Opal.def(self, '$olist', TMP_DocBook5Converter_olist_18 = function $$olist(node) {
        var TMP_17, self = this, result = nil, num_attribute = nil, start_attribute = nil;

        
        result = [];
        num_attribute = (function() {if ($truthy(node.$style())) {
          return "" + " numeration=\"" + (node.$style()) + "\""
        } else {
          return ""
        }; return nil; })();
        start_attribute = (function() {if ($truthy(node['$attr?']("start"))) {
          return "" + " startingnumber=\"" + (node.$attr("start")) + "\""
        } else {
          return ""
        }; return nil; })();
        result['$<<']("" + "<orderedlist" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + (num_attribute) + (start_attribute) + ">");
        if ($truthy(node['$title?']())) {
          result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
        $send(node.$items(), 'each', [], (TMP_17 = function(item){var self = TMP_17.$$s || this;
if (item == null) item = nil;
        
          result['$<<']("<listitem>");
          result['$<<']("" + "<simpara>" + (item.$text()) + "</simpara>");
          if ($truthy(item['$blocks?']())) {
            result['$<<'](item.$content())};
          return result['$<<']("</listitem>");}, TMP_17.$$s = self, TMP_17.$$arity = 1, TMP_17));
        result['$<<']("</orderedlist>");
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_olist_18.$$arity = 1);
      
      Opal.def(self, '$open', TMP_DocBook5Converter_open_19 = function $$open(node) {
        var $a, $b, self = this, $case = nil, id = nil, reftext = nil, role = nil, content_spacer = nil;

        return (function() {$case = node.$style();
        if ("abstract"['$===']($case)) {if ($truthy((($a = node.$parent()['$=='](node.$document())) ? node.$document().$doctype()['$==']("book") : node.$parent()['$=='](node.$document())))) {
          
          self.$logger().$warn("abstract block cannot be used in a document without a title when doctype is book. Excluding block content.");
          return "";
        } else {
          return "" + "<abstract>\n" + (self.$title_tag(node)) + (self.$resolve_content(node)) + "\n" + "</abstract>"
        }}
        else if ("partintro"['$===']($case)) {if ($truthy(($truthy($a = (($b = node.$level()['$=='](0)) ? node.$parent().$context()['$==']("section") : node.$level()['$=='](0))) ? node.$document().$doctype()['$==']("book") : $a))) {
          return "" + "<partintro" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$title_tag(node)) + (self.$resolve_content(node)) + "\n" + "</partintro>"
        } else {
          
          self.$logger().$error("partintro block can only be used when doctype is book and must be a child of a book part. Excluding block content.");
          return "";
        }}
        else {
        if ($truthy((id = node.$id()))) {
          reftext = node.$reftext()};
        role = node.$role();
        if ($truthy(node['$title?']())) {
          return "" + "<formalpara" + (self.$common_attributes(id, role, reftext)) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + "<para>" + ((content_spacer = (function() {if (node.$content_model()['$==']("compound")) {
            return $$($nesting, 'LF')
          } else {
            return ""
          }; return nil; })())) + (node.$content()) + (content_spacer) + "</para>\n" + "</formalpara>"
        } else if ($truthy(($truthy($a = id) ? $a : role))) {
          if (node.$content_model()['$==']("compound")) {
            return "" + "<para" + (self.$common_attributes(id, role, reftext)) + ">\n" + (node.$content()) + "\n" + "</para>"
          } else {
            return "" + "<simpara" + (self.$common_attributes(id, role, reftext)) + ">" + (node.$content()) + "</simpara>"
          }
        } else {
          return self.$resolve_content(node)
        };}})()
      }, TMP_DocBook5Converter_open_19.$$arity = 1);
      
      Opal.def(self, '$page_break', TMP_DocBook5Converter_page_break_20 = function $$page_break(node) {
        var self = this;

        return "<simpara><?asciidoc-pagebreak?></simpara>"
      }, TMP_DocBook5Converter_page_break_20.$$arity = 1);
      
      Opal.def(self, '$paragraph', TMP_DocBook5Converter_paragraph_21 = function $$paragraph(node) {
        var self = this;

        if ($truthy(node['$title?']())) {
          return "" + "<formalpara" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + "<title>" + (node.$title()) + "</title>\n" + "<para>" + (node.$content()) + "</para>\n" + "</formalpara>"
        } else {
          return "" + "<simpara" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">" + (node.$content()) + "</simpara>"
        }
      }, TMP_DocBook5Converter_paragraph_21.$$arity = 1);
      
      Opal.def(self, '$preamble', TMP_DocBook5Converter_preamble_22 = function $$preamble(node) {
        var self = this;

        if (node.$document().$doctype()['$==']("book")) {
          return "" + "<preface" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$title_tag(node, false)) + (node.$content()) + "\n" + "</preface>"
        } else {
          return node.$content()
        }
      }, TMP_DocBook5Converter_preamble_22.$$arity = 1);
      
      Opal.def(self, '$quote', TMP_DocBook5Converter_quote_24 = function $$quote(node) {
        var $a, TMP_23, self = this;

        return $send(self, 'blockquote_tag', [node, ($truthy($a = node['$has_role?']("epigraph")) ? "epigraph" : $a)], (TMP_23 = function(){var self = TMP_23.$$s || this;

        return self.$resolve_content(node)}, TMP_23.$$s = self, TMP_23.$$arity = 0, TMP_23))
      }, TMP_DocBook5Converter_quote_24.$$arity = 1);
      
      Opal.def(self, '$thematic_break', TMP_DocBook5Converter_thematic_break_25 = function $$thematic_break(node) {
        var self = this;

        return "<simpara><?asciidoc-hr?></simpara>"
      }, TMP_DocBook5Converter_thematic_break_25.$$arity = 1);
      
      Opal.def(self, '$sidebar', TMP_DocBook5Converter_sidebar_26 = function $$sidebar(node) {
        var self = this;

        return "" + "<sidebar" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">\n" + (self.$title_tag(node)) + (self.$resolve_content(node)) + "\n" + "</sidebar>"
      }, TMP_DocBook5Converter_sidebar_26.$$arity = 1);
      Opal.const_set($nesting[0], 'TABLE_PI_NAMES', ["dbhtml", "dbfo", "dblatex"]);
      
      Opal.def(self, '$table', TMP_DocBook5Converter_table_32 = function $$table(node) {
        var TMP_27, TMP_28, TMP_29, self = this, has_body = nil, result = nil, pgwide_attribute = nil, frame = nil, tag_name = nil, col_width_key = nil, width = nil;

        
        has_body = false;
        result = [];
        pgwide_attribute = (function() {if ($truthy(node['$option?']("pgwide"))) {
          return " pgwide=\"1\""
        } else {
          return ""
        }; return nil; })();
        if ((frame = node.$attr("frame", "all"))['$==']("ends")) {
          frame = "topbot"};
        result['$<<']("" + "<" + ((tag_name = (function() {if ($truthy(node['$title?']())) {
          return "table"
        } else {
          return "informaltable"
        }; return nil; })())) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + (pgwide_attribute) + " frame=\"" + (frame) + "\" rowsep=\"" + ((function() {if ($truthy(["none", "cols"]['$include?'](node.$attr("grid")))) {
          return 0
        } else {
          return 1
        }; return nil; })()) + "\" colsep=\"" + ((function() {if ($truthy(["none", "rows"]['$include?'](node.$attr("grid")))) {
          return 0
        } else {
          return 1
        }; return nil; })()) + "\"" + ((function() {if ($truthy(node['$attr?']("orientation", "landscape", false))) {
          return " orient=\"land\""
        } else {
          return ""
        }; return nil; })()) + ">");
        if ($truthy(node['$option?']("unbreakable"))) {
          result['$<<']("<?dbfo keep-together=\"always\"?>")
        } else if ($truthy(node['$option?']("breakable"))) {
          result['$<<']("<?dbfo keep-together=\"auto\"?>")};
        if (tag_name['$==']("table")) {
          result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
        col_width_key = (function() {if ($truthy((width = (function() {if ($truthy(node['$attr?']("width"))) {
          
          return node.$attr("width");
        } else {
          return nil
        }; return nil; })()))) {
          
          $send($$($nesting, 'TABLE_PI_NAMES'), 'each', [], (TMP_27 = function(pi_name){var self = TMP_27.$$s || this;
if (pi_name == null) pi_name = nil;
          return result['$<<']("" + "<?" + (pi_name) + " table-width=\"" + (width) + "\"?>")}, TMP_27.$$s = self, TMP_27.$$arity = 1, TMP_27));
          return "colabswidth";
        } else {
          return "colpcwidth"
        }; return nil; })();
        result['$<<']("" + "<tgroup cols=\"" + (node.$attr("colcount")) + "\">");
        $send(node.$columns(), 'each', [], (TMP_28 = function(col){var self = TMP_28.$$s || this;
if (col == null) col = nil;
        return result['$<<']("" + "<colspec colname=\"col_" + (col.$attr("colnumber")) + "\" colwidth=\"" + (col.$attr(col_width_key)) + "*\"/>")}, TMP_28.$$s = self, TMP_28.$$arity = 1, TMP_28));
        $send(node.$rows().$by_section(), 'each', [], (TMP_29 = function(tsec, rows){var self = TMP_29.$$s || this, TMP_30;
if (tsec == null) tsec = nil;if (rows == null) rows = nil;
        
          if ($truthy(rows['$empty?']())) {
            return nil;};
          if (tsec['$==']("body")) {
            has_body = true};
          result['$<<']("" + "<t" + (tsec) + ">");
          $send(rows, 'each', [], (TMP_30 = function(row){var self = TMP_30.$$s || this, TMP_31;
if (row == null) row = nil;
          
            result['$<<']("<row>");
            $send(row, 'each', [], (TMP_31 = function(cell){var self = TMP_31.$$s || this, halign_attribute = nil, valign_attribute = nil, colspan_attribute = nil, colnum = nil, rowspan_attribute = nil, entry_start = nil, cell_content = nil, $case = nil, entry_end = nil;
if (cell == null) cell = nil;
            
              halign_attribute = (function() {if ($truthy(cell['$attr?']("halign"))) {
                return "" + " align=\"" + (cell.$attr("halign")) + "\""
              } else {
                return ""
              }; return nil; })();
              valign_attribute = (function() {if ($truthy(cell['$attr?']("valign"))) {
                return "" + " valign=\"" + (cell.$attr("valign")) + "\""
              } else {
                return ""
              }; return nil; })();
              colspan_attribute = (function() {if ($truthy(cell.$colspan())) {
                return "" + " namest=\"col_" + ((colnum = cell.$column().$attr("colnumber"))) + "\" nameend=\"col_" + ($rb_minus($rb_plus(colnum, cell.$colspan()), 1)) + "\""
              } else {
                return ""
              }; return nil; })();
              rowspan_attribute = (function() {if ($truthy(cell.$rowspan())) {
                return "" + " morerows=\"" + ($rb_minus(cell.$rowspan(), 1)) + "\""
              } else {
                return ""
              }; return nil; })();
              entry_start = "" + "<entry" + (halign_attribute) + (valign_attribute) + (colspan_attribute) + (rowspan_attribute) + ">";
              if (tsec['$==']("head")) {
                cell_content = cell.$text()
              } else {
                $case = cell.$style();
                if ("asciidoc"['$===']($case)) {cell_content = cell.$content()}
                else if ("verse"['$===']($case)) {cell_content = "" + "<literallayout>" + (cell.$text()) + "</literallayout>"}
                else if ("literal"['$===']($case)) {cell_content = "" + "<literallayout class=\"monospaced\">" + (cell.$text()) + "</literallayout>"}
                else if ("header"['$===']($case)) {cell_content = (function() {if ($truthy((cell_content = cell.$content())['$empty?']())) {
                  return ""
                } else {
                  return "" + "<simpara><emphasis role=\"strong\">" + ($rb_times(cell_content, "</emphasis></simpara><simpara><emphasis role=\"strong\">")) + "</emphasis></simpara>"
                }; return nil; })()}
                else {cell_content = (function() {if ($truthy((cell_content = cell.$content())['$empty?']())) {
                  return ""
                } else {
                  return "" + "<simpara>" + ($rb_times(cell_content, "</simpara><simpara>")) + "</simpara>"
                }; return nil; })()}
              };
              entry_end = (function() {if ($truthy(node.$document()['$attr?']("cellbgcolor"))) {
                return "" + "<?dbfo bgcolor=\"" + (node.$document().$attr("cellbgcolor")) + "\"?></entry>"
              } else {
                return "</entry>"
              }; return nil; })();
              return result['$<<']("" + (entry_start) + (cell_content) + (entry_end));}, TMP_31.$$s = self, TMP_31.$$arity = 1, TMP_31));
            return result['$<<']("</row>");}, TMP_30.$$s = self, TMP_30.$$arity = 1, TMP_30));
          return result['$<<']("" + "</t" + (tsec) + ">");}, TMP_29.$$s = self, TMP_29.$$arity = 2, TMP_29));
        result['$<<']("</tgroup>");
        result['$<<']("" + "</" + (tag_name) + ">");
        if ($truthy(has_body)) {
        } else {
          self.$logger().$warn("tables must have at least one body row")
        };
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_table_32.$$arity = 1);
      Opal.alias(self, "toc", "skip");
      
      Opal.def(self, '$ulist', TMP_DocBook5Converter_ulist_35 = function $$ulist(node) {
        var TMP_33, TMP_34, self = this, result = nil, mark_type = nil, checklist = nil, mark_attribute = nil;

        
        result = [];
        if (node.$style()['$==']("bibliography")) {
          
          result['$<<']("" + "<bibliodiv" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">");
          if ($truthy(node['$title?']())) {
            result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
          $send(node.$items(), 'each', [], (TMP_33 = function(item){var self = TMP_33.$$s || this;
if (item == null) item = nil;
          
            result['$<<']("<bibliomixed>");
            result['$<<']("" + "<bibliomisc>" + (item.$text()) + "</bibliomisc>");
            if ($truthy(item['$blocks?']())) {
              result['$<<'](item.$content())};
            return result['$<<']("</bibliomixed>");}, TMP_33.$$s = self, TMP_33.$$arity = 1, TMP_33));
          result['$<<']("</bibliodiv>");
        } else {
          
          mark_type = (function() {if ($truthy((checklist = node['$option?']("checklist")))) {
            return "none"
          } else {
            return node.$style()
          }; return nil; })();
          mark_attribute = (function() {if ($truthy(mark_type)) {
            return "" + " mark=\"" + (mark_type) + "\""
          } else {
            return ""
          }; return nil; })();
          result['$<<']("" + "<itemizedlist" + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + (mark_attribute) + ">");
          if ($truthy(node['$title?']())) {
            result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
          $send(node.$items(), 'each', [], (TMP_34 = function(item){var self = TMP_34.$$s || this, $a, text_marker = nil;
if (item == null) item = nil;
          
            text_marker = (function() {if ($truthy(($truthy($a = checklist) ? item['$attr?']("checkbox") : $a))) {
              if ($truthy(item['$attr?']("checked"))) {
                return "&#10003; "
              } else {
                return "&#10063; "
              }
            } else {
              return ""
            }; return nil; })();
            result['$<<']("<listitem>");
            result['$<<']("" + "<simpara>" + (text_marker) + (item.$text()) + "</simpara>");
            if ($truthy(item['$blocks?']())) {
              result['$<<'](item.$content())};
            return result['$<<']("</listitem>");}, TMP_34.$$s = self, TMP_34.$$arity = 1, TMP_34));
          result['$<<']("</itemizedlist>");
        };
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_ulist_35.$$arity = 1);
      
      Opal.def(self, '$verse', TMP_DocBook5Converter_verse_37 = function $$verse(node) {
        var $a, TMP_36, self = this;

        return $send(self, 'blockquote_tag', [node, ($truthy($a = node['$has_role?']("epigraph")) ? "epigraph" : $a)], (TMP_36 = function(){var self = TMP_36.$$s || this;

        return "" + "<literallayout>" + (node.$content()) + "</literallayout>"}, TMP_36.$$s = self, TMP_36.$$arity = 0, TMP_36))
      }, TMP_DocBook5Converter_verse_37.$$arity = 1);
      Opal.alias(self, "video", "skip");
      
      Opal.def(self, '$inline_anchor', TMP_DocBook5Converter_inline_anchor_38 = function $$inline_anchor(node) {
        var $a, self = this, $case = nil, id = nil, path = nil, linkend = nil, text = nil;

        return (function() {$case = node.$type();
        if ("ref"['$===']($case)) {return "" + "<anchor" + (self.$common_attributes((id = node.$id()), nil, ($truthy($a = node.$reftext()) ? $a : "" + "[" + (id) + "]"))) + "/>"}
        else if ("xref"['$===']($case)) {if ($truthy((path = node.$attributes()['$[]']("path")))) {
          return "" + "<link xl:href=\"" + (node.$target()) + "\">" + (($truthy($a = node.$text()) ? $a : path)) + "</link>"
        } else {
          
          linkend = ($truthy($a = node.$attributes()['$[]']("fragment")) ? $a : node.$target());
          if ($truthy((text = node.$text()))) {
            return "" + "<link linkend=\"" + (linkend) + "\">" + (text) + "</link>"
          } else {
            return "" + "<xref linkend=\"" + (linkend) + "\"/>"
          };
        }}
        else if ("link"['$===']($case)) {return "" + "<link xl:href=\"" + (node.$target()) + "\">" + (node.$text()) + "</link>"}
        else if ("bibref"['$===']($case)) {return "" + "<anchor" + (self.$common_attributes(node.$id(), nil, (text = node.$text()))) + "/>" + (text)}
        else {
        self.$logger().$warn("" + "unknown anchor type: " + (node.$type().$inspect()));
        return nil;}})()
      }, TMP_DocBook5Converter_inline_anchor_38.$$arity = 1);
      
      Opal.def(self, '$inline_break', TMP_DocBook5Converter_inline_break_39 = function $$inline_break(node) {
        var self = this;

        return "" + (node.$text()) + "<?asciidoc-br?>"
      }, TMP_DocBook5Converter_inline_break_39.$$arity = 1);
      
      Opal.def(self, '$inline_button', TMP_DocBook5Converter_inline_button_40 = function $$inline_button(node) {
        var self = this;

        return "" + "<guibutton>" + (node.$text()) + "</guibutton>"
      }, TMP_DocBook5Converter_inline_button_40.$$arity = 1);
      
      Opal.def(self, '$inline_callout', TMP_DocBook5Converter_inline_callout_41 = function $$inline_callout(node) {
        var self = this;

        return "" + "<co" + (self.$common_attributes(node.$id())) + "/>"
      }, TMP_DocBook5Converter_inline_callout_41.$$arity = 1);
      
      Opal.def(self, '$inline_footnote', TMP_DocBook5Converter_inline_footnote_42 = function $$inline_footnote(node) {
        var self = this;

        if (node.$type()['$==']("xref")) {
          return "" + "<footnoteref linkend=\"" + (node.$target()) + "\"/>"
        } else {
          return "" + "<footnote" + (self.$common_attributes(node.$id())) + "><simpara>" + (node.$text()) + "</simpara></footnote>"
        }
      }, TMP_DocBook5Converter_inline_footnote_42.$$arity = 1);
      
      Opal.def(self, '$inline_image', TMP_DocBook5Converter_inline_image_43 = function $$inline_image(node) {
        var self = this, width_attribute = nil, depth_attribute = nil;

        
        width_attribute = (function() {if ($truthy(node['$attr?']("width"))) {
          return "" + " contentwidth=\"" + (node.$attr("width")) + "\""
        } else {
          return ""
        }; return nil; })();
        depth_attribute = (function() {if ($truthy(node['$attr?']("height"))) {
          return "" + " contentdepth=\"" + (node.$attr("height")) + "\""
        } else {
          return ""
        }; return nil; })();
        return "" + "<inlinemediaobject>\n" + "<imageobject>\n" + "<imagedata fileref=\"" + ((function() {if (node.$type()['$==']("icon")) {
          
          return node.$icon_uri(node.$target());
        } else {
          
          return node.$image_uri(node.$target());
        }; return nil; })()) + "\"" + (width_attribute) + (depth_attribute) + "/>\n" + "</imageobject>\n" + "<textobject><phrase>" + (node.$alt()) + "</phrase></textobject>\n" + "</inlinemediaobject>";
      }, TMP_DocBook5Converter_inline_image_43.$$arity = 1);
      
      Opal.def(self, '$inline_indexterm', TMP_DocBook5Converter_inline_indexterm_44 = function $$inline_indexterm(node) {
        var self = this, terms = nil, result = nil, numterms = nil;

        if (node.$type()['$==']("visible")) {
          return "" + "<indexterm><primary>" + (node.$text()) + "</primary></indexterm>" + (node.$text())
        } else {
          
          terms = node.$attr("terms");
          result = [];
          if ($truthy($rb_gt((numterms = terms.$size()), 2))) {
            result['$<<']("" + "<indexterm>\n" + "<primary>" + (terms['$[]'](0)) + "</primary><secondary>" + (terms['$[]'](1)) + "</secondary><tertiary>" + (terms['$[]'](2)) + "</tertiary>\n" + "</indexterm>")};
          if ($truthy($rb_gt(numterms, 1))) {
            result['$<<']("" + "<indexterm>\n" + "<primary>" + (terms['$[]'](-2)) + "</primary><secondary>" + (terms['$[]'](-1)) + "</secondary>\n" + "</indexterm>")};
          result['$<<']("" + "<indexterm>\n" + "<primary>" + (terms['$[]'](-1)) + "</primary>\n" + "</indexterm>");
          return $rb_times(result, $$($nesting, 'LF'));
        }
      }, TMP_DocBook5Converter_inline_indexterm_44.$$arity = 1);
      
      Opal.def(self, '$inline_kbd', TMP_DocBook5Converter_inline_kbd_45 = function $$inline_kbd(node) {
        var self = this, keys = nil;

        if ((keys = node.$attr("keys")).$size()['$=='](1)) {
          return "" + "<keycap>" + (keys['$[]'](0)) + "</keycap>"
        } else {
          return "" + "<keycombo><keycap>" + ($rb_times(keys, "</keycap><keycap>")) + "</keycap></keycombo>"
        }
      }, TMP_DocBook5Converter_inline_kbd_45.$$arity = 1);
      
      Opal.def(self, '$inline_menu', TMP_DocBook5Converter_inline_menu_46 = function $$inline_menu(node) {
        var self = this, menu = nil, submenus = nil, menuitem = nil;

        
        menu = node.$attr("menu");
        if ($truthy((submenus = node.$attr("submenus"))['$empty?']())) {
          if ($truthy((menuitem = node.$attr("menuitem", nil, false)))) {
            return "" + "<menuchoice><guimenu>" + (menu) + "</guimenu> <guimenuitem>" + (menuitem) + "</guimenuitem></menuchoice>"
          } else {
            return "" + "<guimenu>" + (menu) + "</guimenu>"
          }
        } else {
          return "" + "<menuchoice><guimenu>" + (menu) + "</guimenu> <guisubmenu>" + ($rb_times(submenus, "</guisubmenu> <guisubmenu>")) + "</guisubmenu> <guimenuitem>" + (node.$attr("menuitem")) + "</guimenuitem></menuchoice>"
        };
      }, TMP_DocBook5Converter_inline_menu_46.$$arity = 1);
      
      $writer = [["", "", true]];
      $send(Opal.const_set($nesting[0], 'QUOTE_TAGS', $hash2(["monospaced", "emphasis", "strong", "double", "single", "mark", "superscript", "subscript"], {"monospaced": ["<literal>", "</literal>", false], "emphasis": ["<emphasis>", "</emphasis>", true], "strong": ["<emphasis role=\"strong\">", "</emphasis>", true], "double": ["<quote>", "</quote>", true], "single": ["<quote>", "</quote>", true], "mark": ["<emphasis role=\"marked\">", "</emphasis>", false], "superscript": ["<superscript>", "</superscript>", false], "subscript": ["<subscript>", "</subscript>", false]})), 'default=', Opal.to_a($writer));
      $writer[$rb_minus($writer["length"], 1)];;
      
      Opal.def(self, '$inline_quoted', TMP_DocBook5Converter_inline_quoted_47 = function $$inline_quoted(node) {
        var $a, $b, $c, self = this, type = nil, equation = nil, open = nil, close = nil, supports_phrase = nil, text = nil, quoted_text = nil;

        if ((type = node.$type())['$==']("asciimath")) {
          if ((self.asciimath = ($truthy($a = self.asciimath) ? $a : (function() {if ($truthy(($truthy($b = (($c = $$$('::', 'AsciiMath', 'skip_raise')) ? 'constant' : nil)) ? $b : $$($nesting, 'Helpers').$require_library("asciimath", true, "warn"))['$nil?']())) {
            return "unavailable"
          } else {
            return "loaded"
          }; return nil; })()))['$==']("loaded")) {
            return "" + "<inlineequation>" + ($$$('::', 'AsciiMath').$parse(node.$text()).$to_mathml("mml:", $hash2(["xmlns:mml"], {"xmlns:mml": "http://www.w3.org/1998/Math/MathML"}))) + "</inlineequation>"
          } else {
            return "" + "<inlineequation><mathphrase><![CDATA[" + (node.$text()) + "]]></mathphrase></inlineequation>"
          }
        } else if (type['$==']("latexmath")) {
          return "" + "<inlineequation><alt><![CDATA[" + ((equation = node.$text())) + "]]></alt><mathphrase><![CDATA[" + (equation) + "]]></mathphrase></inlineequation>"
        } else {
          
          $b = $$($nesting, 'QUOTE_TAGS')['$[]'](type), $a = Opal.to_ary($b), (open = ($a[0] == null ? nil : $a[0])), (close = ($a[1] == null ? nil : $a[1])), (supports_phrase = ($a[2] == null ? nil : $a[2])), $b;
          text = node.$text();
          if ($truthy(node.$role())) {
            if ($truthy(supports_phrase)) {
              quoted_text = "" + (open) + "<phrase role=\"" + (node.$role()) + "\">" + (text) + "</phrase>" + (close)
            } else {
              quoted_text = "" + (open.$chop()) + " role=\"" + (node.$role()) + "\">" + (text) + (close)
            }
          } else {
            quoted_text = "" + (open) + (text) + (close)
          };
          if ($truthy(node.$id())) {
            return "" + "<anchor" + (self.$common_attributes(node.$id(), nil, text)) + "/>" + (quoted_text)
          } else {
            return quoted_text
          };
        }
      }, TMP_DocBook5Converter_inline_quoted_47.$$arity = 1);
      
      Opal.def(self, '$common_attributes', TMP_DocBook5Converter_common_attributes_48 = function $$common_attributes(id, role, reftext) {
        var $a, self = this, attrs = nil;

        if (role == null) {
          role = nil;
        }
        if (reftext == null) {
          reftext = nil;
        }
        
        attrs = (function() {if ($truthy(id)) {
          return "" + " xml:id=\"" + (id) + "\""
        } else {
          return ""
        }; return nil; })();
        if ($truthy(role)) {
          attrs = "" + (attrs) + " role=\"" + (role) + "\""};
        if ($truthy(reftext)) {
          
          if ($truthy(($truthy($a = reftext['$include?']("<")) ? (reftext = reftext.$gsub($$($nesting, 'XmlSanitizeRx'), ""))['$include?'](" ") : $a))) {
            reftext = reftext.$squeeze(" ").$strip()};
          if ($truthy(reftext['$include?']("\""))) {
            reftext = reftext.$gsub("\"", "&quot;")};
          attrs = "" + (attrs) + " xreflabel=\"" + (reftext) + "\"";};
        return attrs;
      }, TMP_DocBook5Converter_common_attributes_48.$$arity = -2);
      
      Opal.def(self, '$doctype_declaration', TMP_DocBook5Converter_doctype_declaration_49 = function $$doctype_declaration(root_tag_name) {
        var self = this;

        return nil
      }, TMP_DocBook5Converter_doctype_declaration_49.$$arity = 1);
      
      Opal.def(self, '$author_tag', TMP_DocBook5Converter_author_tag_50 = function $$author_tag(doc, index) {
        var self = this, firstname_key = nil, middlename_key = nil, lastname_key = nil, email_key = nil, result = nil;

        if (index == null) {
          index = nil;
        }
        
        firstname_key = (function() {if ($truthy(index)) {
          return "" + "firstname_" + (index)
        } else {
          return "firstname"
        }; return nil; })();
        middlename_key = (function() {if ($truthy(index)) {
          return "" + "middlename_" + (index)
        } else {
          return "middlename"
        }; return nil; })();
        lastname_key = (function() {if ($truthy(index)) {
          return "" + "lastname_" + (index)
        } else {
          return "lastname"
        }; return nil; })();
        email_key = (function() {if ($truthy(index)) {
          return "" + "email_" + (index)
        } else {
          return "email"
        }; return nil; })();
        result = [];
        result['$<<']("<author>");
        result['$<<']("<personname>");
        if ($truthy(doc['$attr?'](firstname_key))) {
          result['$<<']("" + "<firstname>" + (doc.$attr(firstname_key)) + "</firstname>")};
        if ($truthy(doc['$attr?'](middlename_key))) {
          result['$<<']("" + "<othername>" + (doc.$attr(middlename_key)) + "</othername>")};
        if ($truthy(doc['$attr?'](lastname_key))) {
          result['$<<']("" + "<surname>" + (doc.$attr(lastname_key)) + "</surname>")};
        result['$<<']("</personname>");
        if ($truthy(doc['$attr?'](email_key))) {
          result['$<<']("" + "<email>" + (doc.$attr(email_key)) + "</email>")};
        result['$<<']("</author>");
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_author_tag_50.$$arity = -2);
      
      Opal.def(self, '$document_info_tag', TMP_DocBook5Converter_document_info_tag_53 = function $$document_info_tag(doc, info_tag_prefix, use_info_tag_prefix) {
        var $a, TMP_51, $b, TMP_52, self = this, result = nil, date = nil, authorcount = nil, back_cover_tag = nil, front_cover_tag = nil, head_docinfo = nil;

        if (use_info_tag_prefix == null) {
          use_info_tag_prefix = false;
        }
        
        if ($truthy(use_info_tag_prefix)) {
        } else {
          info_tag_prefix = ""
        };
        result = [];
        result['$<<']("" + "<" + (info_tag_prefix) + "info>");
        if ($truthy(doc.$notitle())) {
        } else {
          result['$<<'](self.$document_title_tags(doc.$doctitle($hash2(["partition", "use_fallback"], {"partition": true, "use_fallback": true}))))
        };
        if ($truthy((date = (function() {if ($truthy(doc['$attr?']("revdate"))) {
          
          return doc.$attr("revdate");
        } else {
          
          if ($truthy(doc['$attr?']("reproducible"))) {
            return nil
          } else {
            
            return doc.$attr("docdate");
          };
        }; return nil; })()))) {
          result['$<<']("" + "<date>" + (date) + "</date>")};
        if ($truthy(doc['$attr?']("copyright"))) {
          
          $$($nesting, 'CopyrightRx')['$=~'](doc.$attr("copyright"));
          result['$<<']("<copyright>");
          result['$<<']("" + "<holder>" + ((($a = $gvars['~']) === nil ? nil : $a['$[]'](1))) + "</holder>");
          if ($truthy((($a = $gvars['~']) === nil ? nil : $a['$[]'](2)))) {
            result['$<<']("" + "<year>" + ((($a = $gvars['~']) === nil ? nil : $a['$[]'](2))) + "</year>")};
          result['$<<']("</copyright>");};
        if ($truthy(doc['$has_header?']())) {
          
          if ($truthy(doc['$attr?']("author"))) {
            if ($truthy($rb_lt((authorcount = doc.$attr("authorcount").$to_i()), 2))) {
              
              result['$<<'](self.$author_tag(doc));
              if ($truthy(doc['$attr?']("authorinitials"))) {
                result['$<<']("" + "<authorinitials>" + (doc.$attr("authorinitials")) + "</authorinitials>")};
            } else {
              
              result['$<<']("<authorgroup>");
              $send(authorcount, 'times', [], (TMP_51 = function(index){var self = TMP_51.$$s || this;
if (index == null) index = nil;
              return result['$<<'](self.$author_tag(doc, $rb_plus(index, 1)))}, TMP_51.$$s = self, TMP_51.$$arity = 1, TMP_51));
              result['$<<']("</authorgroup>");
            }};
          if ($truthy(($truthy($a = doc['$attr?']("revdate")) ? ($truthy($b = doc['$attr?']("revnumber")) ? $b : doc['$attr?']("revremark")) : $a))) {
            
            result['$<<']("" + "<revhistory>\n" + "<revision>");
            if ($truthy(doc['$attr?']("revnumber"))) {
              result['$<<']("" + "<revnumber>" + (doc.$attr("revnumber")) + "</revnumber>")};
            if ($truthy(doc['$attr?']("revdate"))) {
              result['$<<']("" + "<date>" + (doc.$attr("revdate")) + "</date>")};
            if ($truthy(doc['$attr?']("authorinitials"))) {
              result['$<<']("" + "<authorinitials>" + (doc.$attr("authorinitials")) + "</authorinitials>")};
            if ($truthy(doc['$attr?']("revremark"))) {
              result['$<<']("" + "<revremark>" + (doc.$attr("revremark")) + "</revremark>")};
            result['$<<']("" + "</revision>\n" + "</revhistory>");};
          if ($truthy(use_info_tag_prefix)) {
          } else if ($truthy(($truthy($a = doc['$attr?']("front-cover-image")) ? $a : doc['$attr?']("back-cover-image")))) {
            if ($truthy((back_cover_tag = self.$cover_tag(doc, "back")))) {
              
              result['$<<'](self.$cover_tag(doc, "front", true));
              result['$<<'](back_cover_tag);
            } else if ($truthy((front_cover_tag = self.$cover_tag(doc, "front")))) {
              result['$<<'](front_cover_tag)}};
          if ($truthy((head_docinfo = doc.$docinfo())['$empty?']())) {
          } else {
            result['$<<'](head_docinfo)
          };
          if ($truthy(doc['$attr?']("orgname"))) {
            result['$<<']("" + "<orgname>" + (doc.$attr("orgname")) + "</orgname>")};};
        result['$<<']("" + "</" + (info_tag_prefix) + "info>");
        if (doc.$doctype()['$==']("manpage")) {
          
          result['$<<']("<refmeta>");
          if ($truthy(doc['$attr?']("mantitle"))) {
            result['$<<']("" + "<refentrytitle>" + (doc.$attr("mantitle")) + "</refentrytitle>")};
          if ($truthy(doc['$attr?']("manvolnum"))) {
            result['$<<']("" + "<manvolnum>" + (doc.$attr("manvolnum")) + "</manvolnum>")};
          result['$<<']("" + "<refmiscinfo class=\"source\">" + (doc.$attr("mansource", "&#160;")) + "</refmiscinfo>");
          result['$<<']("" + "<refmiscinfo class=\"manual\">" + (doc.$attr("manmanual", "&#160;")) + "</refmiscinfo>");
          result['$<<']("</refmeta>");
          result['$<<']("<refnamediv>");
          if ($truthy(doc['$attr?']("mannames"))) {
            result = $rb_plus(result, $send(doc.$attr("mannames"), 'map', [], (TMP_52 = function(n){var self = TMP_52.$$s || this;
if (n == null) n = nil;
            return "" + "<refname>" + (n) + "</refname>"}, TMP_52.$$s = self, TMP_52.$$arity = 1, TMP_52)))};
          if ($truthy(doc['$attr?']("manpurpose"))) {
            result['$<<']("" + "<refpurpose>" + (doc.$attr("manpurpose")) + "</refpurpose>")};
          result['$<<']("</refnamediv>");};
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_document_info_tag_53.$$arity = -3);
      
      Opal.def(self, '$document_ns_attributes', TMP_DocBook5Converter_document_ns_attributes_54 = function $$document_ns_attributes(doc) {
        var self = this;

        return " xmlns=\"http://docbook.org/ns/docbook\" xmlns:xl=\"http://www.w3.org/1999/xlink\" version=\"5.0\""
      }, TMP_DocBook5Converter_document_ns_attributes_54.$$arity = 1);
      
      Opal.def(self, '$lang_attribute_name', TMP_DocBook5Converter_lang_attribute_name_55 = function $$lang_attribute_name() {
        var self = this;

        return "xml:lang"
      }, TMP_DocBook5Converter_lang_attribute_name_55.$$arity = 0);
      
      Opal.def(self, '$document_title_tags', TMP_DocBook5Converter_document_title_tags_56 = function $$document_title_tags(title) {
        var self = this;

        if ($truthy(title['$subtitle?']())) {
          return "" + "<title>" + (title.$main()) + "</title>\n" + "<subtitle>" + (title.$subtitle()) + "</subtitle>"
        } else {
          return "" + "<title>" + (title) + "</title>"
        }
      }, TMP_DocBook5Converter_document_title_tags_56.$$arity = 1);
      
      Opal.def(self, '$resolve_content', TMP_DocBook5Converter_resolve_content_57 = function $$resolve_content(node) {
        var self = this;

        if (node.$content_model()['$==']("compound")) {
          return node.$content()
        } else {
          return "" + "<simpara>" + (node.$content()) + "</simpara>"
        }
      }, TMP_DocBook5Converter_resolve_content_57.$$arity = 1);
      
      Opal.def(self, '$title_tag', TMP_DocBook5Converter_title_tag_58 = function $$title_tag(node, optional) {
        var $a, self = this;

        if (optional == null) {
          optional = true;
        }
        if ($truthy(($truthy($a = optional['$!']()) ? $a : node['$title?']()))) {
          return "" + "<title>" + (node.$title()) + "</title>\n"
        } else {
          return ""
        }
      }, TMP_DocBook5Converter_title_tag_58.$$arity = -2);
      
      Opal.def(self, '$cover_tag', TMP_DocBook5Converter_cover_tag_59 = function $$cover_tag(doc, face, use_placeholder) {
        var $a, self = this, cover_image = nil, width_attr = nil, depth_attr = nil, attrs = nil;

        if (use_placeholder == null) {
          use_placeholder = false;
        }
        if ($truthy((cover_image = doc.$attr("" + (face) + "-cover-image")))) {
          
          width_attr = "";
          depth_attr = "";
          if ($truthy(($truthy($a = cover_image['$include?'](":")) ? $$($nesting, 'ImageMacroRx')['$=~'](cover_image) : $a))) {
            
            cover_image = doc.$image_uri((($a = $gvars['~']) === nil ? nil : $a['$[]'](1)));
            if ($truthy((($a = $gvars['~']) === nil ? nil : $a['$[]'](2))['$empty?']())) {
            } else {
              
              attrs = $$($nesting, 'AttributeList').$new((($a = $gvars['~']) === nil ? nil : $a['$[]'](2))).$parse(["alt", "width", "height"]);
              if ($truthy(attrs['$key?']("scaledwidth"))) {
                width_attr = "" + " width=\"" + (attrs['$[]']("scaledwidth")) + "\""
              } else {
                
                if ($truthy(attrs['$key?']("width"))) {
                  width_attr = "" + " contentwidth=\"" + (attrs['$[]']("width")) + "\""};
                if ($truthy(attrs['$key?']("height"))) {
                  depth_attr = "" + " contentdepth=\"" + (attrs['$[]']("height")) + "\""};
              };
            };};
          return "" + "<cover role=\"" + (face) + "\">\n" + "<mediaobject>\n" + "<imageobject>\n" + "<imagedata fileref=\"" + (cover_image) + "\"" + (width_attr) + (depth_attr) + "/>\n" + "</imageobject>\n" + "</mediaobject>\n" + "</cover>";
        } else if ($truthy(use_placeholder)) {
          return "" + "<cover role=\"" + (face) + "\"/>"
        } else {
          return nil
        }
      }, TMP_DocBook5Converter_cover_tag_59.$$arity = -3);
      return (Opal.def(self, '$blockquote_tag', TMP_DocBook5Converter_blockquote_tag_60 = function $$blockquote_tag(node, tag_name) {
        var $a, self = this, $iter = TMP_DocBook5Converter_blockquote_tag_60.$$p, $yield = $iter || nil, start_tag = nil, end_tag = nil, result = nil;

        if (tag_name == null) {
          tag_name = nil;
        }
        if ($iter) TMP_DocBook5Converter_blockquote_tag_60.$$p = null;
        
        if ($truthy(tag_name)) {
          $a = ["" + "<" + (tag_name), "" + "</" + (tag_name) + ">"], (start_tag = $a[0]), (end_tag = $a[1]), $a
        } else {
          $a = ["<blockquote", "</blockquote>"], (start_tag = $a[0]), (end_tag = $a[1]), $a
        };
        result = ["" + (start_tag) + (self.$common_attributes(node.$id(), node.$role(), node.$reftext())) + ">"];
        if ($truthy(node['$title?']())) {
          result['$<<']("" + "<title>" + (node.$title()) + "</title>")};
        if ($truthy(($truthy($a = node['$attr?']("attribution")) ? $a : node['$attr?']("citetitle")))) {
          
          result['$<<']("<attribution>");
          if ($truthy(node['$attr?']("attribution"))) {
            result['$<<'](node.$attr("attribution"))};
          if ($truthy(node['$attr?']("citetitle"))) {
            result['$<<']("" + "<citetitle>" + (node.$attr("citetitle")) + "</citetitle>")};
          result['$<<']("</attribution>");};
        result['$<<'](Opal.yieldX($yield, []));
        result['$<<'](end_tag);
        return $rb_times(result, $$($nesting, 'LF'));
      }, TMP_DocBook5Converter_blockquote_tag_60.$$arity = -2), nil) && 'blockquote_tag';
    })($$($nesting, 'Converter'), $$$($$($nesting, 'Converter'), 'BuiltIn'), $nesting)
  })($nesting[0], $nesting)
})(Opal);


  return {};
}));
